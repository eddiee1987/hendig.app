"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{2099:(e,t,r)=>{r.d(t,{HK:()=>i,LY:()=>d,ND:()=>s,qi:()=>c,y9:()=>o});var a=r(851);let n="https://jntsodzdafscwksizfov.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",n),console.log("Supabase Anon Key:",l?"Set":"Not set"),n&&l||console.error("Supabase credentials are not set correctly in environment variables");let s=(0,a.UU)(n,l);async function o(){try{let{data:e,error:t}=await s.from("lager").select("navn, antall");if(t)return console.error("Error fetching lager:",t),{};let r={};return null==e||e.forEach(e=>{r[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),r}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function i(e){try{let{data:t,error:r}=await s.from("lager").select("id, navn");if(r)return void console.error("Error fetching lager for update:",r);for(let[r,a]of Object.entries(e)){let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),n=null==t?void 0:t.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===r);n?await s.from("lager").update({antall:Number(a)}).eq("id",n.id):await s.from("lager").insert([{navn:e,antall:Number(a)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function c(){try{let{data:e,error:t}=await s.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(t)return console.error("Error fetching lager historikk:",t),window.__supabaseLagerHistorikkError=t,[];return(e||[]).map(e=>{var t,r;return{created_at:e.created_at,navn:(null==(r=e.lager)||null==(t=r[0])?void 0:t.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function d(e){let{key:t,type:r,antall:a,kommentar:n}=e;try{let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null,o=0,{data:i}=await s.from("lager").select("id, antall").eq("navn",e).limit(1);if(i&&0!==i.length){if(l=i[0].id,o=i[0].antall,"inntak"===r)o+=a;else if("uttak"===r){if(i[0].antall<a)return{error:"Ikke nok p\xe5 lager for uttak"};o-=a}else"manuell"===r&&(o=a);let{error:e}=await s.from("lager").update({antall:o}).eq("id",l);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==r)return{error:"Fant ikke varen i lageret"};let{data:t,error:n}=await s.from("lager").insert([{navn:e,antall:Number(a)}]).select("id").single();if(n||!t)return{error:"Kunne ikke opprette ny vare"};l=t.id,o=Number(a)}let{error:c}=await s.from("lager_transactions").insert({lager_id:l,type:r,antall:a,kommentar:n});if(c)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},2227:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(2115);let n=a.forwardRef(function(e,t){let{title:r,titleId:n,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},l),r?a.createElement("title",{id:n},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))})},5306:(e,t,r)=>{r.d(t,{A:()=>h});var a=r(5155),n=r(2115),l=r(2227);let s=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}),o=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),i=n.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?n.createElement("title",{id:a},r):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});var c=r(7794),d=r(9684),m=r(3568);let u=e=>({id:e.id,name:e.name,description:e.description,client:e.client,status:e.status,startDate:e.start_date,endDate:e.end_date,budget:e.budget?Number(e.budget):void 0,priority:e.priority});function h(e){let{projects:t,abonnements:r,inspections:h}=e,[g,x]=(0,n.useState)("month"),[f,p]=(0,n.useState)(new Date),[b,v]=(0,n.useState)([]),[y,j]=(0,n.useState)([]),[w,N]=(0,n.useState)([]),[k,D]=(0,n.useState)("all"),[S,E]=(0,n.useState)(!1),[I,O]=(0,n.useState)(null),[_,A]=(0,n.useState)(null),[M,C]=(0,n.useState)(null),[L,T]=(0,n.useState)(null),[F,R]=(0,n.useState)(!0),[U,Y]=(0,n.useState)("projects"),z=(0,n.useRef)(0),K=(0,n.useRef)(null);function J(e){let t=e.toISOString().split("T")[0];return y.filter(e=>e.scheduledDate===t)}function P(e){let t=e.toISOString().split("T")[0];return w.filter(e=>e.scheduledDate===t)}function q(e){let t=e.toISOString().split("T")[0];return h.filter(e=>e.inspection_date===t)}(0,n.useEffect)(()=>{(async()=>{try{R(!0);let e=(await (0,c.ui)()).map(e=>({...u(e.projects),scheduledDate:e.scheduled_date,scheduledId:e.id}));j(e);let t=await (0,d.s2)();if(!t)throw Error("No data returned from getScheduledAbonnements");let r=t.map(e=>e.abonnementer?{...e.abonnementer,scheduledDate:e.scheduled_date,scheduledId:e.id}:(console.warn("Missing abonnementer data for scheduled item:",e),null)).filter(Boolean);N(r)}catch(e){console.error("Error fetching scheduled data:",e),m.oR.error("Kunne ikke hente planlagte data")}finally{R(!1)}})()},[]),(0,n.useEffect)(()=>{let e=e=>{K.current&&!K.current.contains(e.target)&&S&&E(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[S]),(0,n.useEffect)(()=>{let e=[],t=new Date,r=new Date(f.getFullYear(),f.getMonth(),1),a=new Date(f.getFullYear(),f.getMonth()+1,0),n=(r.getDay()+6)%7;for(let a=r.getDate()-n;a<r.getDate();a++){let r=new Date(f.getFullYear(),f.getMonth(),a);e.push({date:r,dayOfMonth:a,isCurrentMonth:!1,isToday:r.toDateString()===t.toDateString(),projects:J(r),abonnements:P(r),inspections:q(r)})}for(let r=1;r<=a.getDate();r++){let a=new Date(f.getFullYear(),f.getMonth(),r);e.push({date:a,dayOfMonth:r,isCurrentMonth:!0,isToday:a.toDateString()===t.toDateString(),projects:J(a),abonnements:P(a),inspections:q(a)})}let l=42-e.length;for(let r=1;r<=l;r++){let a=new Date(f.getFullYear(),f.getMonth()+1,r);e.push({date:a,dayOfMonth:r,isCurrentMonth:!1,isToday:a.toDateString()===t.toDateString(),projects:J(a),abonnements:P(a),inspections:q(a)})}v(e)},[f,y,w,h]);let V=e=>["Man","Tirs","Ons","Tors","Fre","L\xf8r","S\xf8n"][e],Z=e=>{O(e)},B=(e,t)=>{e.preventDefault()},W=e=>{e.preventDefault(),z.current++},H=e=>{e.preventDefault(),z.current--},G=async(e,t)=>{e.preventDefault(),z.current=0;let r=t.toISOString().split("T")[0];if(I){if(y.some(e=>e.id===I.id&&e.scheduledDate===r))return void O(null);try{let e=await (0,c.Z4)(I.id,r);if(e){let t={...I,scheduledDate:r,scheduledId:e.id};j([...y,t]),m.oR.success("Prosjekt planlagt")}}catch(e){console.error("Error scheduling project:",e),m.oR.error("Kunne ikke planlegge prosjekt")}finally{O(null)}}if(_){if(!_.id){m.oR.error("Ugyldig vedlikeholdsavtale - mangler ID"),A(null);return}if(w.some(e=>e.id===_.id&&e.scheduledDate===r))return void A(null);try{console.log("Attempting to schedule abonnement:",{id:_.id,date:r});let e=await (0,d.lt)(_.id,r);if(e){console.log("Successfully scheduled abonnement:",e);let t={..._,scheduledDate:r,scheduledId:e.id};N([...w,t]),m.oR.success("Vedlikeholdsavtale planlagt")}else console.error("No result returned from scheduleAbonnement"),m.oR.error("Ingen data returnert fra server")}catch(e){console.error("Detailed error scheduling abonnement:",{error:e instanceof Error?e.message:e,stack:e instanceof Error?e.stack:void 0,abonnementId:_.id,date:r}),e instanceof Error?e.message.includes("JWT expired")||e.message.includes("Invalid API key")?m.oR.error("Autentiseringsfeil - sjekk API-n\xf8kkel"):e.message.includes("foreign key constraint")?m.oR.error("Ugyldig vedlikeholdsavtale-ID"):m.oR.error("Feil ved planlegging: ".concat(e.message)):m.oR.error("Ukjent feil ved planlegging")}finally{A(null)}}},X=async(e,t)=>{try{await (0,c.Ub)(e,t),j(y.filter(r=>r.id!==e||r.scheduledDate!==t)),m.oR.success("Prosjekt fjernet fra kalender")}catch(e){console.error("Error removing project from calendar:",e),m.oR.error("Kunne ikke fjerne prosjekt fra kalender")}},Q=async(e,t)=>{try{await (0,d.NA)(e,t),N(w.filter(r=>r.id!==e||r.scheduledDate!==t)),m.oR.success("Vedlikeholdsavtale fjernet fra kalender")}catch(e){console.error("Error removing abonnement from calendar:",e),m.oR.error("Kunne ikke fjerne vedlikeholdsavtale fra kalender")}},$="all"===k?t:t.filter(e=>e.status===k);return(0,a.jsx)("div",{className:"bg-gray-900 rounded-xl border border-gray-800",children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex border-b border-gray-800",children:[(0,a.jsxs)("button",{className:"px-4 py-3 text-sm font-medium flex items-center ".concat("month"===g?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"),onClick:()=>x("month"),children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"M\xe5ned"]}),(0,a.jsxs)("button",{className:"px-4 py-3 text-sm font-medium flex items-center ".concat("week"===g?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"),onClick:()=>x("week"),children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Uke"]}),(0,a.jsxs)("button",{className:"px-4 py-3 text-sm font-medium flex items-center ".concat("day"===g?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"),onClick:()=>x("day"),children:[(0,a.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Dag"]})]}),(0,a.jsxs)("div",{className:"flex flex-1",children:[(0,a.jsxs)("div",{className:"w-1/4 border-r border-gray-800 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex border-b border-gray-700",children:[(0,a.jsx)("button",{className:"flex-1 px-4 py-2 text-sm font-medium ".concat("projects"===U?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"),onClick:()=>Y("projects"),children:"Prosjekter"}),(0,a.jsx)("button",{className:"flex-1 px-4 py-2 text-sm font-medium ".concat("abonnements"===U?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"),onClick:()=>Y("abonnements"),children:"Vedlikeholdsavtaler"})]}),"projects"===U&&(0,a.jsxs)("div",{className:"p-4 flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"Prosjekter"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>E(!S),className:"flex items-center text-sm text-gray-400 hover:text-white",children:[(0,a.jsx)(s,{className:"w-4 h-4 mr-1"}),"Filter: ","all"===k?"Alle":"active"===k?"Aktive":"completed"===k?"Fullf\xf8rte":"Arkiverte"]}),(0,a.jsx)("div",{ref:K,className:"absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg z-10 ".concat(S?"block":"hidden"),children:(0,a.jsxs)("div",{className:"py-1",children:[(0,a.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{D("all"),E(!1)},children:"Alle"}),(0,a.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{D("active"),E(!1)},children:"Aktive"}),(0,a.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{D("completed"),E(!1)},children:"Fullf\xf8rte"}),(0,a.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{D("archived"),E(!1)},children:"Arkiverte"})]})})]})]}),(0,a.jsx)("div",{className:"space-y-2 overflow-y-auto flex-1",children:$.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-3 cursor-move hover:bg-gray-750 border border-gray-700",draggable:!0,onDragStart:()=>Z(e),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:e.name}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-full text-xs font-medium ".concat("high"===e.priority?"bg-red-900/50 text-red-400":"medium"===e.priority?"bg-yellow-900/50 text-yellow-400":"bg-green-900/50 text-green-400"),children:e.priority})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1 truncate",children:e.client})]},e.id))})]}),"abonnements"===U&&(0,a.jsxs)("div",{className:"p-4 flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"Vedlikeholdsavtaler"})}),(0,a.jsx)("div",{className:"space-y-2 overflow-y-auto flex-1",children:r.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-3 cursor-move hover:bg-gray-750 border border-gray-700",draggable:!0,onDragStart:()=>{A(e),O(null)},children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:e.etternavn}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-900/50 text-blue-400",children:"Vedlikehold"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1 truncate",children:e.adresse}),(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.kommune})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white",children:(()=>{if("month"===g)return f.toLocaleDateString("nb-NO",{month:"long",year:"numeric"});if("week"!==g)return f.toLocaleDateString("nb-NO",{weekday:"long",day:"numeric",month:"long",year:"numeric"});{let e=new Date(f),t=e.getDay();e.setDate(e.getDate()+(0===t?-6:1-t));let r=new Date(e);r.setDate(r.getDate()+6);let a=e.getMonth()===r.getMonth()?"":e.toLocaleDateString("nb-NO",{month:"long"})+" ";return"".concat(a).concat(e.getDate(),". - ").concat(r.toLocaleDateString("nb-NO",{day:"numeric",month:"long",year:"numeric"}))}})()}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if("month"===g)p(new Date(f.getFullYear(),f.getMonth()-1,1));else if("week"===g){let e=new Date(f);e.setDate(e.getDate()-7),p(e)}else if("day"===g){let e=new Date(f);e.setDate(e.getDate()-1),p(e)}},className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-gray-800",children:(0,a.jsx)(o,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>{p(new Date)},className:"px-3 py-1.5 text-sm text-gray-400 hover:text-white",children:"I dag"}),(0,a.jsx)("button",{onClick:()=>{if("month"===g)p(new Date(f.getFullYear(),f.getMonth()+1,1));else if("week"===g){let e=new Date(f);e.setDate(e.getDate()+7),p(e)}else if("day"===g){let e=new Date(f);e.setDate(e.getDate()+1),p(e)}},className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-gray-800",children:(0,a.jsx)(i,{className:"w-5 h-5"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 p-2",children:["month"===g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-1",children:[0,1,2,3,4,5,6].map(e=>(0,a.jsx)("div",{className:"text-center text-xs font-medium text-gray-400 py-1",children:V(e)},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 flex-1",children:b.map((e,t)=>(0,a.jsxs)("div",{className:"min-h-[100px] rounded-lg border ".concat(e.isCurrentMonth?e.isToday?"bg-blue-900/20 border-blue-800":"bg-gray-800 border-gray-700":"bg-gray-850 border-gray-800"," p-1 relative"),onDragOver:t=>B(t,e.date),onDragEnter:W,onDragLeave:H,onDrop:t=>G(t,e.date),children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-1",children:(0,a.jsx)("span",{className:"text-xs font-medium ".concat(e.isCurrentMonth?e.isToday?"text-blue-400":"text-white":"text-gray-500"),children:e.dayOfMonth})}),(0,a.jsxs)("div",{className:"space-y-1 overflow-y-auto max-h-[80px] min-h-[60px]",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("bg-gray-700/50")},onDragLeave:e=>{e.currentTarget.classList.remove("bg-gray-700/50")},onDrop:t=>{t.preventDefault(),t.currentTarget.classList.remove("bg-gray-700/50"),G(t,e.date)},children:[e.projects.map(t=>(0,a.jsxs)("div",{className:"text-xs p-1 rounded relative cursor-move transition-all duration-200 hover:shadow-lg ".concat("high"===t.priority?"bg-red-900/30 text-red-400 border border-red-800/50 hover:bg-red-900/40":"medium"===t.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50 hover:bg-yellow-900/40":"bg-green-900/30 text-green-400 border border-green-800/50 hover:bg-green-900/40"),onMouseEnter:()=>C("".concat(t.id,"-").concat(e.date.toISOString())),onMouseLeave:()=>C(null),children:[(0,a.jsx)("div",{className:"truncate",children:t.name}),M==="".concat(t.id,"-").concat(e.date.toISOString())&&(0,a.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-48 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-2 text-xs",children:[(0,a.jsx)("h5",{className:"font-medium text-white mb-1",children:t.name}),(0,a.jsx)("p",{className:"text-gray-400 mb-1",children:t.client}),(0,a.jsx)("p",{className:"text-gray-400 mb-1 line-clamp-2",children:t.description}),(0,a.jsx)("button",{onClick:()=>X(t.id,e.date.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs mt-1",children:"Fjern fra kalender"})]})]},"project-".concat(t.id,"-").concat(e.date.toISOString()))),e.abonnements.map(t=>(0,a.jsxs)("div",{className:"text-xs p-1 rounded relative cursor-move transition-all duration-200 hover:shadow-lg bg-blue-900/30 text-blue-400 border border-blue-800/50 hover:bg-blue-900/40",onMouseEnter:()=>T("".concat(t.id,"-").concat(e.date.toISOString())),onMouseLeave:()=>T(null),children:[(0,a.jsx)("div",{className:"truncate",children:t.etternavn}),L==="".concat(t.id,"-").concat(e.date.toISOString())&&(0,a.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-48 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-2 text-xs",children:[(0,a.jsx)("h5",{className:"font-medium text-white mb-1",children:t.etternavn}),(0,a.jsx)("p",{className:"text-gray-400 mb-1",children:t.adresse}),(0,a.jsx)("p",{className:"text-gray-400 mb-1",children:t.kommune}),(0,a.jsx)("button",{onClick:()=>Q(t.id,e.date.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs mt-1",children:"Fjern fra kalender"})]})]},"abonnement-".concat(t.id,"-").concat(e.date.toISOString()))),e.inspections.map(t=>(0,a.jsxs)("div",{className:"text-xs p-1 rounded relative bg-yellow-900/30 text-yellow-300 border border-yellow-800/50 mt-1 flex items-center gap-1",title:t.inspection_type,children:[(0,a.jsx)("span",{className:"font-bold",children:"Inspeksjon:"})," ",t.customer_name,(0,a.jsx)("span",{className:"ml-auto px-1 py-0.5 rounded bg-yellow-800/50 text-yellow-200 text-[10px]",children:t.inspection_type})]},"inspection-".concat(t.id,"-").concat(e.date.toISOString())))]})]},t))})]}),"week"===g&&(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-1",children:Array.from({length:7}).map((e,t)=>{let r=new Date(f),n=r.getDay(),l=t-(0===n?6:n-1);return r.setDate(r.getDate()+l),(0,a.jsxs)("div",{className:"text-center py-2",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-400",children:V(t)}),(0,a.jsx)("div",{className:"text-sm font-medium ".concat(r.toDateString()===new Date().toDateString()?"text-blue-400":"text-white"),children:r.getDate()})]},t)})}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 flex-1",children:Array.from({length:7}).map((e,t)=>{let r=new Date(f),n=r.getDay(),l=t-(0===n?6:n-1);r.setDate(r.getDate()+l);let s=r.toISOString().split("T")[0],o=y.filter(e=>e.scheduledDate===s),i=w.filter(e=>e.scheduledDate===s);return(0,a.jsx)("div",{className:"min-h-[400px] rounded-lg border ".concat(r.toDateString()===new Date().toDateString()?"bg-blue-900/20 border-blue-800":"bg-gray-800 border-gray-700"," p-2 relative"),onDragOver:e=>B(e,r),onDragEnter:W,onDragLeave:H,onDrop:e=>G(e,r),children:(0,a.jsxs)("div",{className:"space-y-2 overflow-y-auto max-h-full",children:[o.map(e=>(0,a.jsxs)("div",{className:"p-2 rounded relative ".concat("high"===e.priority?"bg-red-900/30 text-red-400 border border-red-800/50":"medium"===e.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50":"bg-green-900/30 text-green-400 border border-green-800/50"),onMouseEnter:()=>C("".concat(e.id,"-").concat(r.toISOString())),onMouseLeave:()=>C(null),children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs mt-1",children:e.client}),M==="".concat(e.id,"-").concat(r.toISOString())&&(0,a.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-64 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-3 text-sm",children:[(0,a.jsx)("h5",{className:"font-medium text-white mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-gray-400 mb-1",children:e.client}),(0,a.jsx)("p",{className:"text-gray-400 mb-2",children:e.description}),(0,a.jsx)("button",{onClick:()=>X(e.id,s),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},"project-".concat(e.id,"-").concat(r.toISOString()))),i.map(e=>(0,a.jsxs)("div",{className:"p-2 rounded relative bg-blue-900/30 text-blue-400 border border-blue-800/50",onMouseEnter:()=>T("".concat(e.id,"-").concat(r.toISOString())),onMouseLeave:()=>T(null),children:[(0,a.jsx)("div",{className:"font-medium",children:e.etternavn}),(0,a.jsx)("div",{className:"text-xs mt-1",children:e.adresse}),L==="".concat(e.id,"-").concat(r.toISOString())&&(0,a.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-64 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-3 text-sm",children:[(0,a.jsx)("h5",{className:"font-medium text-white mb-1",children:e.etternavn}),(0,a.jsx)("p",{className:"text-gray-400 mb-1",children:e.adresse}),(0,a.jsx)("p",{className:"text-gray-400 mb-2",children:e.kommune}),(0,a.jsx)("button",{onClick:()=>Q(e.id,s),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},"abonnement-".concat(e.id,"-").concat(r.toISOString())))]})},t)})})]}),"day"===g&&(0,a.jsx)("div",{className:"flex flex-col h-full",children:(0,a.jsx)("div",{className:"flex-1 p-4 bg-gray-800 rounded-lg border border-gray-700 mt-2 overflow-y-auto",onDragOver:e=>B(e,f),onDragEnter:W,onDragLeave:H,onDrop:e=>G(e,f),children:(0,a.jsxs)("div",{className:"space-y-3",children:[y.filter(e=>e.scheduledDate===f.toISOString().split("T")[0]).map(e=>(0,a.jsxs)("div",{className:"p-4 rounded-lg relative ".concat("high"===e.priority?"bg-red-900/30 text-red-400 border border-red-800/50":"medium"===e.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50":"bg-green-900/30 text-green-400 border border-green-800/50"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-blue-900/50 text-blue-400":"completed"===e.status?"bg-green-900/50 text-green-400":"bg-gray-900/50 text-gray-400"),children:e.status})]}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.description}),(0,a.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Klient: ",(0,a.jsx)("span",{className:"text-white",children:e.client})]}),(0,a.jsx)("button",{onClick:()=>X(e.id,f.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},"project-".concat(e.id))),w.filter(e=>e.scheduledDate===f.toISOString().split("T")[0]).map(e=>(0,a.jsxs)("div",{className:"p-4 rounded-lg relative bg-blue-900/30 text-blue-400 border border-blue-800/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:e.etternavn}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-900/50 text-blue-400",children:"Vedlikehold"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.adresse}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.kommune}),(0,a.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Fornyelse: ",(0,a.jsx)("span",{className:"text-white",children:e.fornyelsesdato})]}),(0,a.jsx)("button",{onClick:()=>Q(e.id,f.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},"abonnement-".concat(e.id))),h.filter(e=>e.inspection_date===f.toISOString().split("T")[0]).map(e=>(0,a.jsxs)("div",{className:"p-4 rounded-lg relative bg-yellow-900/30 text-yellow-300 border border-yellow-800/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("h4",{className:"font-medium text-white",children:["Inspeksjon: ",e.customer_name]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-800/50 text-yellow-200",children:e.inspection_type})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Adresse: ",e.customer_address]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Inspekt\xf8r: ",e.inspector||"-"]}),(0,a.jsx)("div",{className:"mt-3 flex justify-between items-center",children:(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Status: ",(0,a.jsx)("span",{className:"text-white",children:e.status})]})})]},"inspection-".concat(e.id))),0===y.filter(e=>e.scheduledDate===f.toISOString().split("T")[0]).length&&0===w.filter(e=>e.scheduledDate===f.toISOString().split("T")[0]).length&&0===h.filter(e=>e.inspection_date===f.toISOString().split("T")[0]).length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"Ingen aktiviteter planlagt for denne dagen"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Dra et prosjekt eller en vedlikeholdsavtale hit for \xe5 planlegge det"})]})]})})})]})]})]})]})})}},7794:(e,t,r)=>{r.d(t,{JQ:()=>n,Ub:()=>d,Z4:()=>c,gA:()=>l,ui:()=>i,vr:()=>s,xx:()=>o});var a=r(2099);async function n(){let{data:e,error:t}=await a.ND.from("projects").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching projects:",t),t;return e||[]}async function l(e){console.log("Creating project with data:",e);try{console.log("Supabase client:",a.ND);let{data:t,error:r}=await a.ND.from("projects").select("id").limit(1);if(r)throw console.error("Error checking projects table:",r),Error("Table check failed: ".concat(r.message));console.log("Table check result:",t);let{data:n,error:l}=await a.ND.from("projects").insert([e]).select();if(l)throw console.error("Error creating project:",l),Error("Insert failed: ".concat(l.message));return console.log("Project created successfully:",n),null==n?void 0:n[0]}catch(e){throw console.error("Exception in createProject:",e),e}}async function s(e,t){console.log("Updating project with id:",e,"and data:",t);try{let{data:r,error:n}=await a.ND.from("projects").update(t).eq("id",e).select();if(n)throw console.error("Error updating project with id ".concat(e,":"),n),n;return console.log("Project updated successfully:",r),null==r?void 0:r[0]}catch(t){throw console.error("Exception in updateProject for id ".concat(e,":"),t),t}}async function o(e){let{error:t}=await a.ND.from("projects").delete().eq("id",e);if(t)throw console.error("Error deleting project with id ".concat(e,":"),t),t;return!0}async function i(){let{data:e,error:t}=await a.ND.from("scheduled_projects").select("\n      *,\n      projects:project_id (*)\n    ").order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled projects:",t),t;return e||[]}async function c(e,t){let{data:r,error:n}=await a.ND.from("scheduled_projects").insert([{project_id:e,scheduled_date:t}]).select();if(n)throw console.error("Error scheduling project ".concat(e," for date ").concat(t,":"),n),n;return null==r?void 0:r[0]}async function d(e,t){let{error:r}=await a.ND.from("scheduled_projects").delete().eq("project_id",e).eq("scheduled_date",t);if(r)throw console.error("Error unscheduling project ".concat(e," for date ").concat(t,":"),r),r;return!0}},9684:(e,t,r)=>{r.d(t,{CL:()=>i,NA:()=>o,R2:()=>n,lt:()=>s,s2:()=>l});var a=r(2099);async function n(){let{data:e,error:t}=await a.ND.from("abonnementer").select("*").order("etternavn",{ascending:!0});if(t)throw console.error("Error fetching abonnements:",t),t;return e||[]}async function l(){let{data:e,error:t}=await a.ND.from("scheduled_abonnements").select("\n      *,\n      abonnementer:abonnement_id (*)\n    ").order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled abonnements:",t),t;return e||[]}async function s(e,t){try{let r=Number(e);if(isNaN(r))throw Error("Invalid abonnement ID: ".concat(e));if(!t||!Date.parse(t))throw Error("Invalid date format: ".concat(t));let{data:n,error:l}=await a.ND.from("scheduled_abonnements").insert([{abonnement_id:r,scheduled_date:t}]).select();if(l)throw console.error("Error scheduling abonnement ".concat(e," for date ").concat(t,":"),{message:l.message,code:l.code,details:l.details,hint:l.hint}),Error("Failed to schedule: ".concat(l.message));if(!n||0===n.length)throw Error("No data returned from scheduling operation");return n[0]}catch(t){throw console.error("Failed to schedule abonnement ".concat(e,":"),{error:t instanceof Error?t.message:t,stack:t instanceof Error?t.stack:void 0}),Error("Failed to schedule abonnement: ".concat(t instanceof Error?t.message:"Unknown error"))}}async function o(e,t){let{error:r}=await a.ND.from("scheduled_abonnements").delete().eq("abonnement_id",e).eq("scheduled_date",t);if(r)throw console.error("Error unscheduling abonnement ".concat(e," for date ").concat(t,":"),r),r;return!0}async function i(e){let{data:t,error:r}=await a.ND.from("abonnementer").insert([{fornavn:e.fornavn,etternavn:e.etternavn,adresse:e.adresse,kommune:e.kommune,var:e.var,host:e.host,epost:e.epost,fakturert:e.fakturert,fornyelsesdato:e.fornyelsesdato,sum:e.sum,notat:e.notat}]).select();if(r)throw console.error("Error creating abonnement:",r),r;return null==t?void 0:t[0]}}}]);