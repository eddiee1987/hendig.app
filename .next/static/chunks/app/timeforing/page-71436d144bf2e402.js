(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{2099:(e,r,t)=>{"use strict";t.d(r,{HK:()=>o,LY:()=>c,ND:()=>n,qi:()=>d,y9:()=>i});var l=t(851);let a="https://jntsodzdafscwksizfov.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",a),console.log("Supabase Anon Key:",s?"Set":"Not set"),a&&s||console.error("Supabase credentials are not set correctly in environment variables");let n=(0,l.UU)(a,s);async function i(){try{let{data:e,error:r}=await n.from("lager").select("navn, antall");if(r)return console.error("Error fetching lager:",r),{};let t={};return null==e||e.forEach(e=>{t[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),t}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function o(e){try{let{data:r,error:t}=await n.from("lager").select("id, navn");if(t)return void console.error("Error fetching lager for update:",t);for(let[t,l]of Object.entries(e)){let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),a=null==r?void 0:r.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===t);a?await n.from("lager").update({antall:Number(l)}).eq("id",a.id):await n.from("lager").insert([{navn:e,antall:Number(l)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function d(){try{let{data:e,error:r}=await n.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(r)return console.error("Error fetching lager historikk:",r),window.__supabaseLagerHistorikkError=r,[];return(e||[]).map(e=>{var r,t;return{created_at:e.created_at,navn:(null==(t=e.lager)||null==(r=t[0])?void 0:r.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function c(e){let{key:r,type:t,antall:l,kommentar:a}=e;try{let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),s=null,i=0,{data:o}=await n.from("lager").select("id, antall").eq("navn",e).limit(1);if(o&&0!==o.length){if(s=o[0].id,i=o[0].antall,"inntak"===t)i+=l;else if("uttak"===t){if(o[0].antall<l)return{error:"Ikke nok p\xe5 lager for uttak"};i-=l}else"manuell"===t&&(i=l);let{error:e}=await n.from("lager").update({antall:i}).eq("id",s);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==t)return{error:"Fant ikke varen i lageret"};let{data:r,error:a}=await n.from("lager").insert([{navn:e,antall:Number(l)}]).select("id").single();if(a||!r)return{error:"Kunne ikke opprette ny vare"};s=r.id,i=Number(l)}let{error:d}=await n.from("lager_transactions").insert({lager_id:s,type:t,antall:l,kommentar:a});if(d)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},8833:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var l=t(5155),a=t(2115),s=t(2099);function n(){let[e,r]=(0,a.useState)([]),[t,n]=(0,a.useState)({date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",project:"",comments:""}),[i,o]=(0,a.useState)("all"),[d,c]=(0,a.useState)("all"),m=[{value:"Skigard",label:"Skigard",icon:(0,l.jsxs)("svg",{className:"w-5 h-5 inline mr-2 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"4",y:"10",width:"16",height:"4",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M8 10V6m8 4V6",strokeWidth:"2"})]})},{value:"Torvtak",label:"Torvtak",icon:(0,l.jsxs)("svg",{className:"w-5 h-5 inline mr-2 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"3",y:"12",width:"18",height:"7",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M3 12l9-7 9 7",strokeWidth:"2"})]})},{value:"Administrasjon",label:"Administrasjon",icon:(0,l.jsxs)("svg",{className:"w-5 h-5 inline mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M8 4v16M16 4v16",strokeWidth:"2"})]})},{value:"Transport",label:"Transport",icon:(0,l.jsxs)("svg",{className:"w-5 h-5 inline mr-2 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"3",y:"13",width:"18",height:"6",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M5 13V7a2 2 0 012-2h10a2 2 0 012 2v6",strokeWidth:"2"})]})},{value:"Kl\xf8yving",label:"Kl\xf8yving",icon:(0,l.jsx)("svg",{className:"w-5 h-5 inline mr-2 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{d:"M12 3v18M6 8l6 6 6-6",strokeWidth:"2"})})},{value:"Trefelling",label:"Trefelling",icon:(0,l.jsx)("svg",{className:"w-5 h-5 inline mr-2 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{d:"M12 2v20M6 18l6-6 6 6",strokeWidth:"2"})})}],u=(e,r)=>{let[t,l]=e.split(":").map(Number),[a,s]=r.split(":").map(Number),n=a-t,i=s-l;return i<0&&(n-=1,i+=60),Number((n+i/60).toFixed(2))},x=e=>e.reduce((e,r)=>r.startTime&&r.endTime?e+u(r.startTime,r.endTime):e,0),h=new Date().toISOString().split("T")[0],g=new Date,b=new Date(g);b.setDate(g.getDate()-g.getDay());let f=new Date(g.getFullYear(),g.getMonth(),1),p=(0,a.useMemo)(()=>x(e.filter(e=>e.date===h)),[e,h,x]),j=(0,a.useMemo)(()=>x(e.filter(e=>new Date(e.date)>=b)),[e,x,b]),v=(0,a.useMemo)(()=>x(e.filter(e=>new Date(e.date)>=f)),[e,x,f]);async function w(){try{console.log("Henter timef\xf8ringer...");let{data:e,error:t}=await s.ND.from("time_entries").select("*").order("date",{ascending:!1});if(t)throw console.error("Supabase error:",t),t;let l=e.map(e=>({id:e.id,date:e.date,startTime:e.start_time.substring(0,5),endTime:e.end_time.substring(0,5),project:e.project,comments:e.comments||"",totalHours:e.total_hours}));console.log("Mottatt timef\xf8ringer:",l),r(l||[])}catch(e){console.error("Fetch error:",e),alert("Kunne ikke hente timef\xf8ringer. Pr\xf8v igjen senere.")}}(0,a.useEffect)(()=>{w()},[]);let y=e=>{let{name:r,value:t}=e.target;n(e=>({...e,[r]:t}))},k=async e=>{e.preventDefault();let l=new Date(t.date||""),a=new Date;if(a.setHours(0,0,0,0),l.setHours(0,0,0,0),l>a)return void alert("Du kan ikke f\xf8re timer fram i tid.");try{let e=u(t.startTime||"",t.endTime||""),l={date:t.date,start_time:t.startTime,end_time:t.endTime,project:t.project,comments:t.comments,total_hours:e},{data:a,error:i}=await s.ND.from("time_entries").insert([l]).select();if(i)throw console.error("Supabase insert error:",i),i;let o={id:a[0].id,date:a[0].date,startTime:a[0].start_time.substring(0,5),endTime:a[0].end_time.substring(0,5),project:a[0].project,comments:a[0].comments||"",totalHours:a[0].total_hours};r(e=>[o,...e]),n({date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",project:"",comments:""}),console.log("Timef\xf8ring lagret:",o)}catch(e){console.error("Submit error:",e),alert("Kunne ikke lagre timef\xf8ring. Pr\xf8v igjen senere.")}},N=async e=>{if(window.confirm("Er du sikker p\xe5 at du vil slette denne timef\xf8ringen?"))try{let{error:t}=await s.ND.from("time_entries").delete().eq("id",e);if(t)throw console.error("Supabase delete error:",t),t;r(r=>r.filter(r=>r.id!==e)),console.log("Timef\xf8ring slettet:",e)}catch(e){console.error("Delete error:",e),alert("Kunne ikke slette timef\xf8ring. Pr\xf8v igjen senere.")}},T=e.filter(e=>{let r="all"===i||e.project===i,t=new Date(e.date),l=new Date,a=!0;return"week"===d?a=t>=new Date(l.setDate(l.getDate()-7)):"month"===d&&(a=t>=new Date(l.setMonth(l.getMonth()-1))),r&&a}),S=Array.from(new Set(e.map(e=>e.project)));return(0,l.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-12",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-white",children:"Timef\xf8ring"}),(0,l.jsx)("p",{className:"text-gray-400 mt-2",children:"Hold oversikt over dine timer"})]}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{onClick:()=>{let e=new Blob([["Dato,Prosjekt,Starttid,Sluttid,Timer,Kommentarer",...T.map(e=>[e.date,e.project,e.startTime,e.endTime,e.totalHours,'"'.concat(e.comments,'"')].join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download="timeforing.csv",r.click()},className:"bg-gray-800 hover:bg-gray-700 text-gray-300 px-6 py-3 rounded-full flex items-center gap-2 shadow-sm border border-gray-700 transition-all duration-200 hover:shadow-md",children:(0,l.jsx)("span",{children:"Eksporter CSV"})}),(0,l.jsx)("button",{onClick:()=>alert("Send til Fiken-funksjon kommer snart!"),className:"bg-blue-700 hover:bg-blue-800 text-white px-6 py-3 rounded-full flex items-center gap-2 shadow-sm border border-blue-800 transition-all duration-200 hover:shadow-md",children:(0,l.jsx)("span",{children:"Send timeliste til Fiken"})})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-12",children:[(0,l.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-700 hover:shadow-md transition-all duration-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-gray-400 font-medium",children:"Timer i dag"}),(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-900/50 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-6 h-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M12 6v6l4 2",strokeWidth:"2"})]})})]}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-white mt-4",children:[p.toFixed(2)," t"]})]}),(0,l.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-700 hover:shadow-md transition-all duration-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-gray-400 font-medium",children:"Timer denne uken"}),(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-900/50 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-6 h-6 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M8 4v16M16 4v16",strokeWidth:"2"})]})})]}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-white mt-4",children:[j.toFixed(2)," t"]})]}),(0,l.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-700 hover:shadow-md transition-all duration-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-gray-400 font-medium",children:"Timer denne m\xe5neden"}),(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-purple-900/50 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-6 h-6 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("rect",{x:"3",y:"12",width:"18",height:"7",rx:"2",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M3 12l9-7 9 7",strokeWidth:"2"})]})})]}),(0,l.jsxs)("p",{className:"text-3xl font-bold text-white mt-4",children:[v.toFixed(2)," t"]})]})]}),(0,l.jsx)("div",{className:"bg-gray-800 rounded-2xl p-6 mb-12 shadow-sm border border-gray-700",children:(0,l.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,l.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"rounded-full border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",children:[(0,l.jsx)("option",{value:"all",children:"Alle prosjekter"}),S.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("select",{value:d,onChange:e=>c(e.target.value),className:"rounded-full border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",children:[(0,l.jsx)("option",{value:"all",children:"All tid"}),(0,l.jsx)("option",{value:"week",children:"Siste uke"}),(0,l.jsx)("option",{value:"month",children:"Siste m\xe5ned"})]})]})}),(0,l.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 mb-12 shadow-sm border border-gray-700",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-6 text-white",children:"Registrer timer"}),(0,l.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Dato"}),(0,l.jsx)("input",{type:"date",name:"date",value:t.date,onChange:y,className:"w-full rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Prosjekt"}),(0,l.jsxs)("select",{name:"project",value:t.project,onChange:y,className:"w-full rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",required:!0,children:[(0,l.jsx)("option",{value:"",children:"Velg prosjekt..."}),m.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Starttid"}),(0,l.jsx)("input",{type:"time",name:"startTime",value:t.startTime,onChange:y,className:"w-full rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Sluttid"}),(0,l.jsx)("input",{type:"time",name:"endTime",value:t.endTime,onChange:y,className:"w-full rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",required:!0})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-400",children:"Kommentarer"}),(0,l.jsx)("textarea",{name:"comments",value:t.comments,onChange:y,rows:3,className:"w-full rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300"})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-sm transition-colors",children:"Lagre timer"})})]})]}),(0,l.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-700",children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-6 text-white",children:"Registrerte timer"}),(0,l.jsxs)("div",{className:"space-y-4",children:[T.map(e=>{var r;return(0,l.jsx)("div",{className:"border-b border-gray-700 pb-4 last:border-b-0",children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-white",children:e.project}),(0,l.jsxs)("p",{className:"text-sm text-gray-400",children:[new Date(e.date).toLocaleDateString("nb-NO")," (",e.startTime," - ",e.endTime,")"]}),(0,l.jsxs)("p",{className:"text-sm text-blue-400 font-medium",children:["Timer: ",null==(r=e.totalHours)?void 0:r.toFixed(2)]}),e.comments&&(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:e.comments})]}),(0,l.jsx)("button",{onClick:()=>N(e.id),className:"text-red-500 hover:text-red-600",children:"Slett"})]})},e.id)}),0===T.length&&(0,l.jsx)("p",{className:"text-gray-500 text-center",children:"Ingen timef\xf8ringer registrert"})]})]})]})})}},8912:(e,r,t)=>{Promise.resolve().then(t.bind(t,8833))}},e=>{var r=r=>e(e.s=r);e.O(0,[851,441,684,358],()=>r(8912)),_N_E=e.O()}]);