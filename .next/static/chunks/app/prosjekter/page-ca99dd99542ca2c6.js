(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{105:(e,t,r)=>{Promise.resolve().then(r.bind(r,888))},888:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),l=r(2115),s=r(7794),n=r(3568);let o=e=>{let t={id:"",name:e.name||"",description:e.description||"",client:e.client||"",status:e.status||"active",start_date:e.startDate||new Date().toISOString().split("T")[0],priority:e.priority||"medium",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return e.endDate&&""!==e.endDate&&(t.end_date=e.endDate),void 0!==e.budget&&null!==e.budget&&(t.budget=e.budget),console.log("Converted project for Supabase:",t),t},i=e=>({id:e.id,name:e.name,description:e.description,client:e.client,status:e.status,startDate:e.start_date,endDate:e.end_date,budget:e.budget?Number(e.budget):void 0,priority:e.priority});function c(){let[e,t]=(0,l.useState)([]),[r,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),[g,m]=(0,l.useState)(null),[x,p]=(0,l.useState)({name:"",description:"",client:"",status:"active",startDate:new Date().toISOString().split("T")[0],endDate:"",budget:void 0,priority:"medium"});(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,s.JQ)();t(e.map(i))}catch(e){console.error("Error fetching projects:",e),n.oR.error("Kunne ikke hente prosjekter")}})()},[]);let b=async r=>{if(r.preventDefault(),x.name&&x.client)try{let r=o(x),a=await (0,s.gA)(r);a&&(t([i(a),...e]),n.oR.success("Prosjekt opprettet")),p({name:"",description:"",client:"",status:"active",startDate:new Date().toISOString().split("T")[0],endDate:"",budget:void 0,priority:"medium"}),c(!1)}catch(e){console.error("Error creating project:",e),n.oR.error("Kunne ikke opprette prosjekt")}},h=async r=>{if(window.confirm("Er du sikker p\xe5 at du vil slette dette prosjektet?"))try{await (0,s.xx)(r),t(e.filter(e=>e.id!==r)),n.oR.success("Prosjekt slettet")}catch(e){console.error("Error deleting project:",e),n.oR.error("Kunne ikke slette prosjekt")}},f=async(r,a)=>{try{if(!e.find(e=>e.id===r))return;await (0,s.vr)(r,{status:a}),t(e.map(e=>e.id===r?{...e,status:a}:e)),n.oR.success("Status oppdatert")}catch(e){console.error("Error updating project status:",e),n.oR.error("Kunne ikke oppdatere status")}},y=e=>{m(e),u(!0)},j=async r=>{if(r.preventDefault(),g)try{let r=o(g);await (0,s.vr)(g.id,r),t(e.map(e=>e.id===g.id?g:e)),n.oR.success("Prosjekt oppdatert"),u(!1),m(null)}catch(e){console.error("Error updating project:",e),n.oR.error("Kunne ikke oppdatere prosjekt")}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white",children:"Prosjekter"}),(0,a.jsx)("p",{className:"text-gray-400 mt-2",children:"Administrer dine prosjekter"})]}),(0,a.jsxs)("button",{onClick:()=>c(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full flex items-center gap-2 shadow-sm transition-all duration-200",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,a.jsx)("span",{children:"Nytt prosjekt"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-white",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-blue-900/50 text-blue-400":"completed"===e.status?"bg-green-900/50 text-green-400":"bg-gray-900/50 text-gray-400"),children:e.status})]}),(0,a.jsx)("p",{className:"text-gray-400 mb-4",children:e.description}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Klient: ",(0,a.jsx)("span",{className:"text-white",children:e.client})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Startdato: ",(0,a.jsx)("span",{className:"text-white",children:new Date(e.startDate).toLocaleDateString("nb-NO")})]}),e.endDate&&(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Sluttdato: ",(0,a.jsx)("span",{className:"text-white",children:new Date(e.endDate).toLocaleDateString("nb-NO")})]}),e.budget&&(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Budsjett: ",(0,a.jsxs)("span",{className:"text-white",children:[e.budget.toLocaleString("nb-NO")," kr"]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Prioritet: ",(0,a.jsx)("span",{className:"".concat("high"===e.priority?"text-red-400":"medium"===e.priority?"text-yellow-400":"text-green-400"),children:e.priority})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{onClick:()=>y(e),className:"px-3 py-1 rounded-lg text-sm bg-blue-900/50 text-blue-400 hover:bg-blue-900/70",children:"Endre"}),(0,a.jsx)("button",{onClick:()=>f(e.id,"active"),className:"px-3 py-1 rounded-lg text-sm ".concat("active"===e.status?"bg-blue-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"),children:"Aktiv"}),(0,a.jsx)("button",{onClick:()=>f(e.id,"completed"),className:"px-3 py-1 rounded-lg text-sm ".concat("completed"===e.status?"bg-green-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"),children:"Fullf\xf8rt"}),(0,a.jsx)("button",{onClick:()=>f(e.id,"archived"),className:"px-3 py-1 rounded-lg text-sm ".concat("archived"===e.status?"bg-gray-600 text-white":"bg-gray-700 text-gray-400 hover:bg-gray-600"),children:"Arkivert"}),(0,a.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 rounded-lg text-sm bg-red-900/50 text-red-400 hover:bg-red-900/70",children:"Slett"})]})]},e.id))}),d&&g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Endre prosjekt"}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Prosjektnavn"}),(0,a.jsx)("input",{type:"text",value:g.name,onChange:e=>m({...g,name:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Beskrivelse"}),(0,a.jsx)("textarea",{value:g.description,onChange:e=>m({...g,description:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Klient"}),(0,a.jsx)("input",{type:"text",value:g.client,onChange:e=>m({...g,client:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Status"}),(0,a.jsxs)("select",{value:g.status,onChange:e=>m({...g,status:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"active",children:"Aktiv"}),(0,a.jsx)("option",{value:"completed",children:"Fullf\xf8rt"}),(0,a.jsx)("option",{value:"archived",children:"Arkivert"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Prioritet"}),(0,a.jsxs)("select",{value:g.priority,onChange:e=>m({...g,priority:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"low",children:"Lav"}),(0,a.jsx)("option",{value:"medium",children:"Medium"}),(0,a.jsx)("option",{value:"high",children:"H\xf8y"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Startdato"}),(0,a.jsx)("input",{type:"date",value:g.startDate,onChange:e=>m({...g,startDate:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Sluttdato"}),(0,a.jsx)("input",{type:"date",value:g.endDate||"",onChange:e=>m({...g,endDate:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Budsjett"}),(0,a.jsx)("input",{type:"number",value:g.budget||"",onChange:e=>m({...g,budget:e.target.value?Number(e.target.value):void 0}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{u(!1),m(null)},className:"px-4 py-2 text-gray-400 hover:text-white",children:"Avbryt"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Lagre endringer"})]})]})]})}),r&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-8 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-6",children:"Nytt prosjekt"}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Prosjektnavn"}),(0,a.jsx)("input",{type:"text",value:x.name,onChange:e=>p({...x,name:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Beskrivelse"}),(0,a.jsx)("textarea",{value:x.description,onChange:e=>p({...x,description:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Klient"}),(0,a.jsx)("input",{type:"text",value:x.client,onChange:e=>p({...x,client:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Startdato"}),(0,a.jsx)("input",{type:"date",value:x.startDate,onChange:e=>p({...x,startDate:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Sluttdato"}),(0,a.jsx)("input",{type:"date",value:x.endDate||"",onChange:e=>p({...x,endDate:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Budsjett"}),(0,a.jsx)("input",{type:"number",value:x.budget||"",onChange:e=>p({...x,budget:e.target.value?Number(e.target.value):void 0}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Prioritet"}),(0,a.jsxs)("select",{value:x.priority,onChange:e=>p({...x,priority:e.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"low",children:"Lav"}),(0,a.jsx)("option",{value:"medium",children:"Medium"}),(0,a.jsx)("option",{value:"high",children:"H\xf8y"})]})]}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg mt-6",children:"Lagre"})]})]})})]})})}},2099:(e,t,r)=>{"use strict";r.d(t,{HK:()=>i,LY:()=>d,ND:()=>n,qi:()=>c,y9:()=>o});var a=r(851);let l="https://jntsodzdafscwksizfov.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",l),console.log("Supabase Anon Key:",s?"Set":"Not set"),l&&s||console.error("Supabase credentials are not set correctly in environment variables");let n=(0,a.UU)(l,s);async function o(){try{let{data:e,error:t}=await n.from("lager").select("navn, antall");if(t)return console.error("Error fetching lager:",t),{};let r={};return null==e||e.forEach(e=>{r[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),r}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function i(e){try{let{data:t,error:r}=await n.from("lager").select("id, navn");if(r)return void console.error("Error fetching lager for update:",r);for(let[r,a]of Object.entries(e)){let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null==t?void 0:t.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===r);l?await n.from("lager").update({antall:Number(a)}).eq("id",l.id):await n.from("lager").insert([{navn:e,antall:Number(a)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function c(){try{let{data:e,error:t}=await n.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(t)return console.error("Error fetching lager historikk:",t),window.__supabaseLagerHistorikkError=t,[];return(e||[]).map(e=>{var t,r;return{created_at:e.created_at,navn:(null==(r=e.lager)||null==(t=r[0])?void 0:t.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function d(e){let{key:t,type:r,antall:a,kommentar:l}=e;try{let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),s=null,o=0,{data:i}=await n.from("lager").select("id, antall").eq("navn",e).limit(1);if(i&&0!==i.length){if(s=i[0].id,o=i[0].antall,"inntak"===r)o+=a;else if("uttak"===r){if(i[0].antall<a)return{error:"Ikke nok p\xe5 lager for uttak"};o-=a}else"manuell"===r&&(o=a);let{error:e}=await n.from("lager").update({antall:o}).eq("id",s);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==r)return{error:"Fant ikke varen i lageret"};let{data:t,error:l}=await n.from("lager").insert([{navn:e,antall:Number(a)}]).select("id").single();if(l||!t)return{error:"Kunne ikke opprette ny vare"};s=t.id,o=Number(a)}let{error:c}=await n.from("lager_transactions").insert({lager_id:s,type:r,antall:a,kommentar:l});if(c)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},7794:(e,t,r)=>{"use strict";r.d(t,{JQ:()=>l,Ub:()=>d,Z4:()=>c,gA:()=>s,ui:()=>i,vr:()=>n,xx:()=>o});var a=r(2099);async function l(){let{data:e,error:t}=await a.ND.from("projects").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching projects:",t),t;return e||[]}async function s(e){console.log("Creating project with data:",e);try{console.log("Supabase client:",a.ND);let{data:t,error:r}=await a.ND.from("projects").select("id").limit(1);if(r)throw console.error("Error checking projects table:",r),Error("Table check failed: ".concat(r.message));console.log("Table check result:",t);let{data:l,error:s}=await a.ND.from("projects").insert([e]).select();if(s)throw console.error("Error creating project:",s),Error("Insert failed: ".concat(s.message));return console.log("Project created successfully:",l),null==l?void 0:l[0]}catch(e){throw console.error("Exception in createProject:",e),e}}async function n(e,t){console.log("Updating project with id:",e,"and data:",t);try{let{data:r,error:l}=await a.ND.from("projects").update(t).eq("id",e).select();if(l)throw console.error("Error updating project with id ".concat(e,":"),l),l;return console.log("Project updated successfully:",r),null==r?void 0:r[0]}catch(t){throw console.error("Exception in updateProject for id ".concat(e,":"),t),t}}async function o(e){let{error:t}=await a.ND.from("projects").delete().eq("id",e);if(t)throw console.error("Error deleting project with id ".concat(e,":"),t),t;return!0}async function i(){let{data:e,error:t}=await a.ND.from("scheduled_projects").select("\n      *,\n      projects:project_id (*)\n    ").order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled projects:",t),t;return e||[]}async function c(e,t){let{data:r,error:l}=await a.ND.from("scheduled_projects").insert([{project_id:e,scheduled_date:t}]).select();if(l)throw console.error("Error scheduling project ".concat(e," for date ").concat(t,":"),l),l;return null==r?void 0:r[0]}async function d(e,t){let{error:r}=await a.ND.from("scheduled_projects").delete().eq("project_id",e).eq("scheduled_date",t);if(r)throw console.error("Error unscheduling project ".concat(e," for date ").concat(t,":"),r),r;return!0}}},e=>{var t=t=>e(e.s=t);e.O(0,[851,568,441,684,358],()=>t(105)),_N_E=e.O()}]);