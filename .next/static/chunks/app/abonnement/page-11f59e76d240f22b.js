(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[876],{2099:(e,t,r)=>{"use strict";r.d(t,{HK:()=>i,LY:()=>c,ND:()=>l,qi:()=>d,y9:()=>o});var s=r(851);let n="https://jntsodzdafscwksizfov.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",n),console.log("Supabase Anon Key:",a?"Set":"Not set"),n&&a||console.error("Supabase credentials are not set correctly in environment variables");let l=(0,s.UU)(n,a);async function o(){try{let{data:e,error:t}=await l.from("lager").select("navn, antall");if(t)return console.error("Error fetching lager:",t),{};let r={};return null==e||e.forEach(e=>{r[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),r}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function i(e){try{let{data:t,error:r}=await l.from("lager").select("id, navn");if(r)return void console.error("Error fetching lager for update:",r);for(let[r,s]of Object.entries(e)){let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),n=null==t?void 0:t.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===r);n?await l.from("lager").update({antall:Number(s)}).eq("id",n.id):await l.from("lager").insert([{navn:e,antall:Number(s)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function d(){try{let{data:e,error:t}=await l.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(t)return console.error("Error fetching lager historikk:",t),window.__supabaseLagerHistorikkError=t,[];return(e||[]).map(e=>{var t,r;return{created_at:e.created_at,navn:(null==(r=e.lager)||null==(t=r[0])?void 0:t.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function c(e){let{key:t,type:r,antall:s,kommentar:n}=e;try{let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),a=null,o=0,{data:i}=await l.from("lager").select("id, antall").eq("navn",e).limit(1);if(i&&0!==i.length){if(a=i[0].id,o=i[0].antall,"inntak"===r)o+=s;else if("uttak"===r){if(i[0].antall<s)return{error:"Ikke nok p\xe5 lager for uttak"};o-=s}else"manuell"===r&&(o=s);let{error:e}=await l.from("lager").update({antall:o}).eq("id",a);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==r)return{error:"Fant ikke varen i lageret"};let{data:t,error:n}=await l.from("lager").insert([{navn:e,antall:Number(s)}]).select("id").single();if(n||!t)return{error:"Kunne ikke opprette ny vare"};a=t.id,o=Number(s)}let{error:d}=await l.from("lager_transactions").insert({lager_id:a,type:r,antall:s,kommentar:n});if(d)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},3399:(e,t,r)=>{Promise.resolve().then(r.bind(r,6696))},6696:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),n=r(2115),a=r(2099),l=r(3568),o=r(6575),i=r(9684);function d(e){let{onImportSuccess:t}=e,[r,a]=(0,n.useState)(!1),[d,c]=(0,n.useState)(0),[m,u]=(0,n.useState)(0),[x,h]=(0,n.useState)(0),[b,g]=(0,n.useState)(!1),f=async e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(r){a(!0),c(0),h(0);try{let t=await y(r);if(0===t.length){l.oR.error("Ingen data funnet i filen"),a(!1);return}u(t.length),await v(t),l.oR.success("".concat(t.length," abonnementer importert")),e.target.value=""}catch(e){console.error("Error importing abonnements:",e),l.oR.error("Kunne ikke importere abonnementer")}finally{a(!1)}}},p=e=>{if(null==e)return"";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Date)return e.toISOString().split("T")[0];if("object"==typeof e&&"result"in e){var t;return(null==(t=e.result)?void 0:t.toString())||""}return(null==e?void 0:e.toString())||""},y=async e=>new Promise((t,r)=>{let s=new FileReader;s.onload=async e=>{try{var s;let r=null==(s=e.target)?void 0:s.result,n=new o.Workbook;await n.xlsx.load(r);let a=n.worksheets[0],l=a.getSheetValues().filter((e,t)=>t>1&&e).map(e=>{let t={};return a.getRow(1).eachCell((r,s)=>{if(r.text&&e&&Array.isArray(e)){let n=p(e[s]);null!=n&&(t[r.text]=n)}}),t}).map(e=>{var t,r,s,n,a,l,o,i,d,c;return{fornavn:String(null!=(t=e.Fornavn)?t:""),etternavn:String(null!=(r=e.Etternavn)?r:""),adresse:String(null!=(s=e.Adresse)?s:""),kommune:String(null!=(n=e.Kommune)?n:""),var_utfort:"boolean"==typeof e["V\xe5r utf\xf8rt"]?e["V\xe5r utf\xf8rt"]:"ja"===String(null!=(a=e["V\xe5r utf\xf8rt"])?a:"").toLowerCase(),host_utfort:"boolean"==typeof e["H\xf8st utf\xf8rt"]?e["H\xf8st utf\xf8rt"]:"ja"===String(null!=(l=e["H\xf8st utf\xf8rt"])?l:"").toLowerCase(),epost:String(null!=(o=e["E-post"])?o:""),fakturert:"boolean"==typeof e.Fakturert?e.Fakturert:"ja"===String(null!=(i=e.Fakturert)?i:"").toLowerCase(),fornyelsesdato:j(e.Fornyelsesdato),sum:Number(null!=(d=e.Sum)?d:0),notat:String(null!=(c=e.Notat)?c:"")}});t(l)}catch(e){r(e)}},s.onerror=e=>r(e),s.readAsBinaryString(e)}),j=e=>{if(null==e)return"";if("number"==typeof e)return new Date(new Date(1900,0,1).getTime()+(e-1)*864e5).toISOString().split("T")[0];if("string"==typeof e){let t=e.split(".");if(3===t.length)return"".concat(t[2],"-").concat(t[1].padStart(2,"0"),"-").concat(t[0].padStart(2,"0"));if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e}return e instanceof Date?e.toISOString().split("T")[0]:""},v=async e=>{for(let t=0;t<e.length;t++){let r=e[t];try{await (0,i.CL)({fornavn:r.fornavn,etternavn:r.etternavn,adresse:r.adresse,kommune:r.kommune,var:r.var_utfort?"utf\xf8rt":"ikke utf\xf8rt",host:r.host_utfort?"utf\xf8rt":"ikke utf\xf8rt",epost:r.epost,fakturert:r.fakturert,fornyelsesdato:r.fornyelsesdato,sum:r.sum,notat:r.notat}),h(t+1),c(Math.round((t+1)/e.length*100))}catch(e){console.error("Error creating abonnement ".concat(r.etternavn,":"),e)}}t&&t()};return(0,s.jsxs)("div",{className:"bg-gray-900 rounded-xl border border-gray-800 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Importer abonnementer"}),b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-gray-400 mb-2",children:"Last opp en Excel-fil med abonnementer. Filen m\xe5 inneholde f\xf8lgende kolonner:"}),(0,s.jsxs)("ul",{className:"text-gray-400 text-sm list-disc pl-5 mb-4",children:[(0,s.jsx)("li",{children:"Fornavn"}),(0,s.jsx)("li",{children:"Etternavn"}),(0,s.jsx)("li",{children:"Adresse"}),(0,s.jsx)("li",{children:"Kommune"}),(0,s.jsx)("li",{children:"V\xe5r (sjekkboks)"}),(0,s.jsx)("li",{children:"H\xf8st (sjekkboks)"}),(0,s.jsx)("li",{children:"E-post"}),(0,s.jsx)("li",{children:"Fakturert (sjekkboks)"}),(0,s.jsx)("li",{children:"Fornyelsesdato"}),(0,s.jsx)("li",{children:"Sum"}),(0,s.jsx)("li",{children:"Notat"})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium text-white",children:"Velg Excel-fil"}),(0,s.jsx)("input",{type:"file",accept:".xlsx, .xls",onChange:f,disabled:r,className:"block w-full text-sm text-gray-400 border border-gray-700 rounded-lg cursor-pointer bg-gray-800 focus:outline-none"})]}),r&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-white",children:"Importerer..."}),(0,s.jsxs)("span",{className:"text-sm font-medium text-white",children:[d,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(d,"%")}})}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:[x," av ",m," abonnementer importert"]})]})]}):(0,s.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>g(!0),children:"Importer kunder fra fil"})]})}function c(){let[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!0),[o,i]=(0,n.useState)(null),[c,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)({etternavn:"",adresse:"",kommune:"",fornyelsesdato:"",tak_storrelse:""}),[h,b]=(0,n.useState)(""),[g,f]=(0,n.useState)(null),[p,y]=(0,n.useState)("kontakt"),[j,v]=(0,n.useState)(!1),[k,N]=(0,n.useState)(null),[w,S]=(0,n.useState)([]),[C,_]=(0,n.useState)(!1),[F,L]=(0,n.useState)(!1),[A]=(0,n.useState)([]),[E,I]=(0,n.useState)(!1),[D]=(0,n.useState)([{dato:"2025-01-15",belop:2500,status:"betalt"},{dato:"2024-07-20",belop:2500,status:"betalt"},{dato:"2024-01-15",belop:2300,status:"betalt"},{dato:"2023-07-20",belop:2300,status:"betalt"}]),[K]=(0,n.useState)([{dato:"2025-03-10",utfort_av:"Ole Hansen",kommentar:"Alt ser bra ut",status:"godkjent"},{dato:"2024-09-05",utfort_av:"Kari Olsen",kommentar:"Noen omr\xe5der trenger ekstra vedlikehold",status:"mangler"},{dato:"2024-03-12",utfort_av:"Ole Hansen",kommentar:"Fikset mangler fra forrige inspeksjon",status:"godkjent"},{dato:"2023-09-08",utfort_av:"Kari Olsen",kommentar:"Alt ser bra ut",status:"godkjent"}]),[M]=(0,n.useState)([{dato:"2025-03-10",ansatt:"Ole Hansen",varighet:"2 timer",kommentar:"Vanlig vedlikehold"},{dato:"2024-09-05",ansatt:"Kari Olsen",varighet:"3 timer",kommentar:"Ekstra arbeid p\xe5 nordside"},{dato:"2024-03-12",ansatt:"Ole Hansen",varighet:"2 timer",kommentar:"Vanlig vedlikehold"},{dato:"2023-09-08",ansatt:"Kari Olsen",varighet:"2 timer",kommentar:"Vanlig vedlikehold"}]);async function H(e){try{console.log("Henter abonnementer...");let r=a.ND.from("abonnementer").select("*");e&&(r=r.or("etternavn.ilike.%".concat(e,"%,adresse.ilike.%").concat(e,"%,kommune.ilike.%").concat(e,"%")));let{data:s,error:n}=await r;if(n)throw console.error("Supabase error:",n),n;console.log("Mottatt data:",s),t(s||[])}catch(e){console.error("Fetch error:",e),i("Kunne ikke hente abonnementer")}finally{l(!1)}}(0,n.useEffect)(()=>{H()},[]);let O=e=>{let{name:t,value:r}=e.target;x(e=>({...e,[t]:r}))},B=async e=>{e.preventDefault();try{b("Lagrer ny kunde...");let e={etternavn:u.etternavn,adresse:u.adresse,kommune:u.kommune,fornyelsesdato:u.fornyelsesdato,tak_storrelse:u.tak_storrelse,sted:"",var:"",host:"",epost:"",fakturert:"",mail_var:"",mail_host:"",tidsbruk_slatt:"",sum:"",notat:""},{error:t}=await a.ND.from("abonnementer").insert([e]);if(t)throw console.error("Supabase insert error:",t),t;x({etternavn:"",adresse:"",kommune:"",fornyelsesdato:"",tak_storrelse:""}),b("Kunde lagt til!"),m(!1),H(),setTimeout(()=>{b("")},3e3)}catch(e){console.error("Submit error:",e),b("Kunne ikke lagre ny kunde")}};return r?(0,s.jsxs)("div",{className:"text-center text-white",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),(0,s.jsx)("p",{className:"mt-4",children:"Laster abonnementer..."})]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-center mb-12",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-white mb-4",children:"Vedlikeholdsabonnementer"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Administrer torvtak vedlikeholdsabonnementer"})]}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(d,{onImportSuccess:H})}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:o?"Feil ved lasting av abonnementer":"Abonnementer"}),(0,s.jsxs)("div",{className:"relative w-64",children:[(0,s.jsx)("input",{type:"text",placeholder:"S\xf8k i kunder...",className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onChange:e=>{H(e.target.value.toLowerCase())}}),(0,s.jsx)("svg",{className:"absolute right-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center ".concat(0===w.length?"opacity-50 cursor-not-allowed":""),onClick:()=>{w.length>0&&L(!0)},disabled:0===w.length,children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Slett (",w.length,")"]}),(0,s.jsx)("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",onClick:()=>{_(!1),S([])},children:"Avbryt"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center",onClick:()=>_(!0),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Slett kunder"]}),(0,s.jsxs)("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",onClick:()=>m(!0),children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Legg til ny kunde"]})]})})]}),o?(0,s.jsx)("p",{className:"text-red-500",children:o}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[C&&(0,s.jsx)("th",{className:"pb-3 w-10",children:(0,s.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500",onChange:t=>{t.target.checked?S(e.filter(e=>e.id).map(e=>e.id)):S([])},checked:w.length===e.filter(e=>e.id).length&&e.length>0})}),(0,s.jsx)("th",{className:"pb-3",children:"Navn"}),(0,s.jsx)("th",{className:"pb-3",children:"Adresse"}),(0,s.jsx)("th",{className:"pb-3",children:"Kommune"}),(0,s.jsx)("th",{className:"pb-3",children:"V\xe5r"}),(0,s.jsx)("th",{className:"pb-3",children:"H\xf8st"}),(0,s.jsx)("th",{className:"pb-3",children:"Fornyelsesdato"}),(0,s.jsx)("th",{className:"pb-3",children:"Status"})]})}),(0,s.jsx)("tbody",{children:e.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700 text-gray-300 hover:bg-gray-700 cursor-pointer transition-colors",onClick:t=>{C?"INPUT"!==t.target.tagName&&(t.preventDefault(),e.id&&(w.includes(e.id)?S(t=>t.filter(t=>t!==e.id)):S(t=>[...t,e.id]))):f(e)},children:[C&&(0,s.jsx)("td",{className:"py-3 pl-3",children:(0,s.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500",checked:!!e.id&&w.includes(e.id),onChange:t=>{e.id&&(t.target.checked?S(t=>[...t,e.id]):S(t=>t.filter(t=>t!==e.id)))},onClick:e=>e.stopPropagation()})}),(0,s.jsx)("td",{className:"py-3",children:e.etternavn}),(0,s.jsx)("td",{className:"py-3",children:e.adresse}),(0,s.jsx)("td",{className:"py-3",children:e.kommune||"-"}),(0,s.jsx)("td",{className:"py-3",children:e.var}),(0,s.jsx)("td",{className:"py-3",children:e.host}),(0,s.jsx)("td",{className:"py-3",children:e.fornyelsesdato}),(0,s.jsx)("td",{className:"py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-green-900/20 text-green-400",children:"Aktiv"})})]},t))})]})})]}),g&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:g.etternavn}),(0,s.jsx)("button",{onClick:()=>f(null),className:"text-gray-400 hover:text-white",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"flex border-b border-gray-700 mb-6",children:[(0,s.jsx)("button",{className:"px-4 py-2 font-medium ".concat("betalinger"===p?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>y("betalinger"),children:"Betalinger"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium ".concat("inspeksjoner"===p?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>y("inspeksjoner"),children:"Inspeksjoner"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium ".concat("besok"===p?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>y("besok"),children:"Bes\xf8k"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium ".concat("kontakt"===p?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"),onClick:()=>y("kontakt"),children:"Kontaktinfo"})]}),(0,s.jsxs)("div",{children:["betalinger"===p&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h4",{className:"text-lg font-medium text-white",children:"Betalingshistorikk"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Registrer ny betaling"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[(0,s.jsx)("th",{className:"pb-2",children:"Dato"}),(0,s.jsx)("th",{className:"pb-2",children:"Bel\xf8p"}),(0,s.jsx)("th",{className:"pb-2",children:"Status"})]})}),(0,s.jsx)("tbody",{children:D.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700 text-gray-300",children:[(0,s.jsx)("td",{className:"py-3",children:e.dato}),(0,s.jsxs)("td",{className:"py-3",children:[e.belop," kr"]}),(0,s.jsx)("td",{className:"py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("betalt"===e.status?"bg-green-900/20 text-green-400":"ubetalt"===e.status?"bg-yellow-900/20 text-yellow-400":"bg-red-900/20 text-red-400"),children:"betalt"===e.status?"Betalt":"ubetalt"===e.status?"Ubetalt":"Forsinket"})})]},t))})]})})]}),"inspeksjoner"===p&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h4",{className:"text-lg font-medium text-white",children:"Inspeksjonshistorikk"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Registrer ny inspeksjon"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[(0,s.jsx)("th",{className:"pb-2",children:"Dato"}),(0,s.jsx)("th",{className:"pb-2",children:"Utf\xf8rt av"}),(0,s.jsx)("th",{className:"pb-2",children:"Kommentar"}),(0,s.jsx)("th",{className:"pb-2",children:"Status"})]})}),(0,s.jsx)("tbody",{children:K.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700 text-gray-300",children:[(0,s.jsx)("td",{className:"py-3",children:e.dato}),(0,s.jsx)("td",{className:"py-3",children:e.utfort_av}),(0,s.jsx)("td",{className:"py-3",children:e.kommentar}),(0,s.jsx)("td",{className:"py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("godkjent"===e.status?"bg-green-900/20 text-green-400":"bg-yellow-900/20 text-yellow-400"),children:"godkjent"===e.status?"Godkjent":"Mangler"})})]},t))})]})})]}),"besok"===p&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h4",{className:"text-lg font-medium text-white",children:"Bes\xf8kshistorikk"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Registrer nytt bes\xf8k"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[(0,s.jsx)("th",{className:"pb-2",children:"Dato"}),(0,s.jsx)("th",{className:"pb-2",children:"Ansatt"}),(0,s.jsx)("th",{className:"pb-2",children:"Varighet"}),(0,s.jsx)("th",{className:"pb-2",children:"Kommentar"})]})}),(0,s.jsx)("tbody",{children:M.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700 text-gray-300",children:[(0,s.jsx)("td",{className:"py-3",children:e.dato}),(0,s.jsx)("td",{className:"py-3",children:e.ansatt}),(0,s.jsx)("td",{className:"py-3",children:e.varighet}),(0,s.jsx)("td",{className:"py-3",children:e.kommentar})]},t))})]})})]}),"kontakt"===p&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h4",{className:"text-lg font-medium text-white",children:"Kontaktinformasjon"}),j?(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",onClick:()=>{v(!1),N(null)},children:"Avbryt"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm",onClick:async()=>{if(k)try{let{error:e}=await a.ND.from("abonnementer").update({etternavn:k.etternavn,adresse:k.adresse,kommune:k.kommune,epost:k.epost,fornyelsesdato:k.fornyelsesdato,tak_storrelse:k.tak_storrelse,notat:k.notat}).eq("id",k.id);if(e)throw console.error("Update error:",e),e;f(k),v(!1),H()}catch(e){console.error("Update error:",e)}},children:"Lagre"})]}):(0,s.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",onClick:()=>{v(!0),N(g)},children:"Rediger"})]}),j?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-etternavn",className:"block text-sm font-medium text-gray-400 mb-1",children:"Navn"}),(0,s.jsx)("input",{type:"text",id:"edit-etternavn",value:(null==k?void 0:k.etternavn)||"",onChange:e=>{k&&N({...k,etternavn:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-adresse",className:"block text-sm font-medium text-gray-400 mb-1",children:"Adresse"}),(0,s.jsx)("input",{type:"text",id:"edit-adresse",value:(null==k?void 0:k.adresse)||"",onChange:e=>{k&&N({...k,adresse:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-kommune",className:"block text-sm font-medium text-gray-400 mb-1",children:"Kommune"}),(0,s.jsx)("input",{type:"text",id:"edit-kommune",value:(null==k?void 0:k.kommune)||"",onChange:e=>{k&&N({...k,kommune:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-epost",className:"block text-sm font-medium text-gray-400 mb-1",children:"E-post"}),(0,s.jsx)("input",{type:"email",id:"edit-epost",value:(null==k?void 0:k.epost)||"",onChange:e=>{k&&N({...k,epost:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-fornyelsesdato",className:"block text-sm font-medium text-gray-400 mb-1",children:"Fornyelsesdato"}),(0,s.jsx)("input",{type:"date",id:"edit-fornyelsesdato",value:(null==k?void 0:k.fornyelsesdato)||"",onChange:e=>{k&&N({...k,fornyelsesdato:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-tak_storrelse",className:"block text-sm font-medium text-gray-400 mb-1",children:"Takst\xf8rrelse"}),(0,s.jsx)("input",{type:"text",id:"edit-tak_storrelse",value:(null==k?void 0:k.tak_storrelse)||"",onChange:e=>{k&&N({...k,tak_storrelse:e.target.value})},className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"f.eks. 120 m\xb2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"edit-notat",className:"block text-sm font-medium text-gray-400 mb-1",children:"Notat"}),(0,s.jsx)("textarea",{id:"edit-notat",value:(null==k?void 0:k.notat)||"",onChange:e=>{k&&N({...k,notat:e.target.value})},rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Navn"}),(0,s.jsx)("p",{className:"text-white",children:g.etternavn})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Adresse"}),(0,s.jsx)("p",{className:"text-white",children:g.adresse})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Kommune"}),(0,s.jsx)("p",{className:"text-white",children:g.kommune||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"E-post"}),(0,s.jsx)("p",{className:"text-white",children:g.epost||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Fornyelsesdato"}),(0,s.jsx)("p",{className:"text-white",children:g.fornyelsesdato||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Takst\xf8rrelse"}),(0,s.jsx)("p",{className:"text-white",children:g.tak_storrelse||"-"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("h5",{className:"text-sm font-medium text-gray-400 mb-1",children:"Notat"}),(0,s.jsx)("p",{className:"text-white",children:g.notat||"-"})]})]})]})]})]})}),F&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 w-full max-w-md",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Bekreft sletting"}),(0,s.jsx)("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-white",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("p",{className:"text-white mb-2",children:["Er du sikker p\xe5 at du vil slette ",w.length," kunde",1!==w.length?"r":"","?"]}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Dette kan ikke angres."})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>L(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Avbryt"}),(0,s.jsx)("button",{type:"button",onClick:async()=>{try{let{error:e}=await a.ND.from("abonnementer").delete().in("id",w);if(e)throw console.error("Delete error:",e),e;L(!1),_(!1),S([]),H()}catch(e){console.error("Delete error:",e)}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Slett"})]})]})}),E&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Potensielle duplikater funnet"}),(0,s.jsx)("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-white",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("p",{className:"text-white mb-2",children:"F\xf8lgende kunder i importfilen kan v\xe6re duplikater av eksisterende kunder:"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mb-4",children:"Vennligst gjennomg\xe5 listen og bekreft om du vil fortsette med importen."}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[(0,s.jsx)("th",{className:"pb-3",children:"Ny kunde"}),(0,s.jsx)("th",{className:"pb-3",children:"Eksisterende kunde"}),(0,s.jsx)("th",{className:"pb-3",children:"\xc5rsak"})]})}),(0,s.jsx)("tbody",{children:A.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700 text-gray-300",children:[(0,s.jsxs)("td",{className:"py-3",children:[(0,s.jsx)("div",{className:"font-medium",children:e.customer.etternavn}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:e.customer.adresse})]}),(0,s.jsxs)("td",{className:"py-3",children:[(0,s.jsx)("div",{className:"font-medium",children:e.existingCustomer.etternavn}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:e.existingCustomer.adresse})]}),(0,s.jsx)("td",{className:"py-3",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-900/20 text-yellow-400",children:e.reason})})]},t))})]})})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{I(!1),console.log("Import avbrutt")},className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Avbryt import"}),(0,s.jsx)("button",{type:"button",onClick:async()=>{try{let e=A.map(e=>e.customer),{error:t}=await a.ND.from("abonnementer").insert(e);if(t){console.error("Supabase insert error:",t),console.error("Import feilet: ".concat(t.message||"Ukjent feil"));return}console.log("Import fullf\xf8rt! ".concat(e.length," abonnementer lagt til.")),I(!1),H()}catch(e){console.error("Import error:",e),console.error("Import feilet: Kunne ikke legge til abonnementer")}},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Fortsett import likevel"})]})]})}),c&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 w-full max-w-md",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Legg til ny kunde"}),(0,s.jsx)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-white",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("form",{onSubmit:B,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"etternavn",className:"block text-sm font-medium text-gray-400 mb-1",children:"Navn"}),(0,s.jsx)("input",{type:"text",id:"etternavn",name:"etternavn",value:u.etternavn,onChange:O,required:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"adresse",className:"block text-sm font-medium text-gray-400 mb-1",children:"Adresse"}),(0,s.jsx)("input",{type:"text",id:"adresse",name:"adresse",value:u.adresse,onChange:O,required:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"kommune",className:"block text-sm font-medium text-gray-400 mb-1",children:"Kommune"}),(0,s.jsx)("input",{type:"text",id:"kommune",name:"kommune",value:u.kommune,onChange:O,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"fornyelsesdato",className:"block text-sm font-medium text-gray-400 mb-1",children:"Fornyelsesdato"}),(0,s.jsx)("input",{type:"date",id:"fornyelsesdato",name:"fornyelsesdato",value:u.fornyelsesdato,onChange:O,required:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"tak_storrelse",className:"block text-sm font-medium text-gray-400 mb-1",children:"St\xf8rrelse p\xe5 tak"}),(0,s.jsx)("input",{type:"text",id:"tak_storrelse",name:"tak_storrelse",value:u.tak_storrelse,onChange:O,required:!0,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"f.eks. 120 m\xb2"})]})]}),h&&(0,s.jsx)("p",{className:"mt-4 ".concat(h.includes("ikke")?"text-red-500":"text-green-500"),children:h}),(0,s.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Avbryt"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Lagre"})]})]})]})})]})}},9684:(e,t,r)=>{"use strict";r.d(t,{CL:()=>i,NA:()=>o,R2:()=>n,lt:()=>l,s2:()=>a});var s=r(2099);async function n(){let{data:e,error:t}=await s.ND.from("abonnementer").select("*").order("etternavn",{ascending:!0});if(t)throw console.error("Error fetching abonnements:",t),t;return e||[]}async function a(){let{data:e,error:t}=await s.ND.from("scheduled_abonnements").select("\n      *,\n      abonnementer:abonnement_id (*)\n    ").order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled abonnements:",t),t;return e||[]}async function l(e,t){try{let r=Number(e);if(isNaN(r))throw Error("Invalid abonnement ID: ".concat(e));if(!t||!Date.parse(t))throw Error("Invalid date format: ".concat(t));let{data:n,error:a}=await s.ND.from("scheduled_abonnements").insert([{abonnement_id:r,scheduled_date:t}]).select();if(a)throw console.error("Error scheduling abonnement ".concat(e," for date ").concat(t,":"),{message:a.message,code:a.code,details:a.details,hint:a.hint}),Error("Failed to schedule: ".concat(a.message));if(!n||0===n.length)throw Error("No data returned from scheduling operation");return n[0]}catch(t){throw console.error("Failed to schedule abonnement ".concat(e,":"),{error:t instanceof Error?t.message:t,stack:t instanceof Error?t.stack:void 0}),Error("Failed to schedule abonnement: ".concat(t instanceof Error?t.message:"Unknown error"))}}async function o(e,t){let{error:r}=await s.ND.from("scheduled_abonnements").delete().eq("abonnement_id",e).eq("scheduled_date",t);if(r)throw console.error("Error unscheduling abonnement ".concat(e," for date ").concat(t,":"),r),r;return!0}async function i(e){let{data:t,error:r}=await s.ND.from("abonnementer").insert([{fornavn:e.fornavn,etternavn:e.etternavn,adresse:e.adresse,kommune:e.kommune,var:e.var,host:e.host,epost:e.epost,fakturert:e.fakturert,fornyelsesdato:e.fornyelsesdato,sum:e.sum,notat:e.notat}]).select();if(r)throw console.error("Error creating abonnement:",r),r;return null==t?void 0:t[0]}}},e=>{var t=t=>e(e.s=t);e.O(0,[343,851,568,441,684,358],()=>t(3399)),_N_E=e.O()}]);