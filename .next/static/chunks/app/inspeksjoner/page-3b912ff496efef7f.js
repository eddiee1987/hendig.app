(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{2099:(e,r,t)=>{"use strict";t.d(r,{HK:()=>o,LY:()=>c,ND:()=>n,qi:()=>d,y9:()=>i});var s=t(851);let a="https://jntsodzdafscwksizfov.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",a),console.log("Supabase Anon Key:",l?"Set":"Not set"),a&&l||console.error("Supabase credentials are not set correctly in environment variables");let n=(0,s.UU)(a,l);async function i(){try{let{data:e,error:r}=await n.from("lager").select("navn, antall");if(r)return console.error("Error fetching lager:",r),{};let t={};return null==e||e.forEach(e=>{t[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),t}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function o(e){try{let{data:r,error:t}=await n.from("lager").select("id, navn");if(t)return void console.error("Error fetching lager for update:",t);for(let[t,s]of Object.entries(e)){let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),a=null==r?void 0:r.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===t);a?await n.from("lager").update({antall:Number(s)}).eq("id",a.id):await n.from("lager").insert([{navn:e,antall:Number(s)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function d(){try{let{data:e,error:r}=await n.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(r)return console.error("Error fetching lager historikk:",r),window.__supabaseLagerHistorikkError=r,[];return(e||[]).map(e=>{var r,t;return{created_at:e.created_at,navn:(null==(t=e.lager)||null==(r=t[0])?void 0:r.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function c(e){let{key:r,type:t,antall:s,kommentar:a}=e;try{let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null,i=0,{data:o}=await n.from("lager").select("id, antall").eq("navn",e).limit(1);if(o&&0!==o.length){if(l=o[0].id,i=o[0].antall,"inntak"===t)i+=s;else if("uttak"===t){if(o[0].antall<s)return{error:"Ikke nok p\xe5 lager for uttak"};i-=s}else"manuell"===t&&(i=s);let{error:e}=await n.from("lager").update({antall:i}).eq("id",l);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==t)return{error:"Fant ikke varen i lageret"};let{data:r,error:a}=await n.from("lager").insert([{navn:e,antall:Number(s)}]).select("id").single();if(a||!r)return{error:"Kunne ikke opprette ny vare"};l=r.id,i=Number(s)}let{error:d}=await n.from("lager_transactions").insert({lager_id:l,type:t,antall:s,kommentar:a});if(d)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},3262:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var s=t(5155),a=t(2115),l=t(5695),n=t(2099),i=t(6874),o=t.n(i);function d(){(0,l.useRouter)();let[e,r]=(0,a.useState)([]),[t,i]=(0,a.useState)(!0),[d,c]=(0,a.useState)(null),[u,x]=(0,a.useState)({planned:0,completed:0,cancelled:0}),[h,m]=(0,a.useState)(""),[p,g]=(0,a.useState)("all"),[f,j]=(0,a.useState)("all");async function b(){try{i(!0);let{data:e,error:t}=await n.ND.from("inspections").select("\n          *,\n          abonnementer:customer_id (etternavn)\n        ").order("inspection_date",{ascending:!1});if(t){console.error("Error fetching inspections:",t),t.message.includes('relation "inspections" does not exist')||t.message.includes("does not exist")||"42P01"===t.code?(console.log("Inspections table not found or not accessible yet"),r([]),x({planned:0,completed:0,cancelled:0})):c("Kunne ikke hente inspeksjoner");return}if(r(e||[]),e){let r=e.filter(e=>"planlagt"===e.status).length,t=e.filter(e=>"utf\xf8rt"===e.status).length;x({planned:r,completed:t,cancelled:0})}}catch(e){console.error("Unexpected error:",e),c("En uventet feil oppstod")}finally{i(!1)}}(0,a.useEffect)(()=>{b()},[]);let v=e.filter(e=>{var r;let t=((null==(r=e.abonnementer)?void 0:r.etternavn)||"").toLowerCase().includes(h.toLowerCase())||e.customer_address.toLowerCase().includes(h.toLowerCase())||e.inspector&&e.inspector.toLowerCase().includes(h.toLowerCase()),s="all"===p||e.inspection_type===p,a="all"===f||e.status===f;return t&&s&&a}),y=async e=>{if(confirm("Er du sikker p\xe5 at du vil slette denne inspeksjonen?"))try{let{error:r}=await n.ND.from("inspections").delete().eq("id",e);if(r)return void console.error("Error deleting inspection:",r);b()}catch(e){console.error("Unexpected error:",e)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-12",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-white",children:"Inspeksjoner"}),(0,s.jsx)("p",{className:"text-gray-400 mt-2",children:"Administrer inspeksjoner og rapporter"})]}),(0,s.jsx)(o(),{href:"/inspeksjoner/ny",children:(0,s.jsxs)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full flex items-center gap-2 shadow-sm transition-all duration-200",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,s.jsx)("span",{children:"Ny inspeksjon"})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-gray-400",children:"Planlagte inspeksjoner"}),(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-900/50 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white mt-2",children:t?(0,s.jsx)("span",{className:"inline-block w-8 h-6 bg-gray-700 animate-pulse rounded"}):u.planned})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-gray-400",children:"Utf\xf8rte inspeksjoner"}),(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-900/50 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white mt-2",children:t?(0,s.jsx)("span",{className:"inline-block w-8 h-6 bg-gray-700 animate-pulse rounded"}):u.completed})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-gray-400",children:"Totalt antall inspeksjoner"}),(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-900/50 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white mt-2",children:t?(0,s.jsx)("span",{className:"inline-block w-8 h-6 bg-gray-700 animate-pulse rounded"}):e.length})]})]}),(0,s.jsx)("div",{className:"bg-gray-800 rounded-2xl p-6 mb-8 border border-gray-700",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsx)("input",{type:"text",placeholder:"S\xf8k etter kunde eller inspekt\xf8r...",className:"flex-1 min-w-[200px] rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",value:h,onChange:e=>m(e.target.value)}),(0,s.jsxs)("select",{className:"rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",value:p,onChange:e=>g(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Alle typer"}),(0,s.jsx)("option",{value:"v\xe5rvedlikehold",children:"V\xe5rvedlikehold"}),(0,s.jsx)("option",{value:"h\xf8stvedlikehold",children:"H\xf8stvedlikehold"}),(0,s.jsx)("option",{value:"rehabilitering",children:"Rehabilitering"})]}),(0,s.jsxs)("select",{className:"rounded-xl border-gray-700 focus:ring-blue-500 focus:border-blue-500 bg-gray-700 text-gray-300",value:f,onChange:e=>j(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"Alle status"}),(0,s.jsx)("option",{value:"planlagt",children:"Planlagt"}),(0,s.jsx)("option",{value:"utf\xf8rt",children:"Utf\xf8rt"})]})]})}),t?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-400",children:"Laster inspeksjoner..."})]}):d?(0,s.jsx)("div",{className:"bg-red-900/20 text-red-400 p-6 rounded-xl text-center",children:d}):0===v.length?(0,s.jsxs)("div",{className:"bg-gray-800 rounded-2xl border border-gray-700 p-12 text-center",children:[(0,s.jsx)("p",{className:"text-gray-400",children:"Ingen inspeksjoner funnet"}),(0,s.jsx)(o(),{href:"/inspeksjoner/ny",children:(0,s.jsx)("button",{className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Opprett ny inspeksjon"})})]}):(0,s.jsx)("div",{className:"bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-400",children:"Kunde"}),(0,s.jsx)("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-400",children:"Dato"}),(0,s.jsx)("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-400",children:"Type"}),(0,s.jsx)("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-400",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-400",children:"Inspekt\xf8r"}),(0,s.jsx)("th",{className:"px-6 py-4 text-right text-sm font-medium text-gray-400",children:"Handling"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-700",children:v.map(e=>{var r;return(0,s.jsxs)("tr",{className:"hover:bg-gray-700/50",children:[(0,s.jsxs)("td",{className:"px-6 py-4",children:[(0,s.jsx)("div",{className:"text-white",children:(null==(r=e.abonnementer)?void 0:r.etternavn)||e.customer_name||"Ukjent kunde"}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:e.customer_address}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[e.before_images&&e.before_images.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"F\xf8r"}),(0,s.jsx)("div",{className:"flex gap-1",children:e.before_images.slice(0,2).map((e,r)=>(0,s.jsx)("img",{src:e,alt:"F\xf8r-bilde",className:"w-10 h-10 object-cover rounded"},r))})]}),e.after_images&&e.after_images.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Etter"}),(0,s.jsx)("div",{className:"flex gap-1",children:e.after_images.slice(0,2).map((e,r)=>(0,s.jsx)("img",{src:e,alt:"Etter-bilde",className:"w-10 h-10 object-cover rounded"},r))})]})]})]}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"text-white",children:new Date(e.inspection_date).toLocaleDateString("nb-NO")})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("v\xe5rvedlikehold"===e.inspection_type?"bg-green-900/50 text-green-400":"h\xf8stvedlikehold"===e.inspection_type?"bg-yellow-900/50 text-yellow-400":"bg-blue-900/50 text-blue-400"),children:e.inspection_type})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("planlagt"===e.status?"bg-yellow-900/50 text-yellow-400":"bg-green-900/50 text-green-400"),children:e.status})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"text-white",children:e.inspector||"-"})}),(0,s.jsx)("td",{className:"px-6 py-4 text-right",children:(0,s.jsxs)("div",{className:"text-white flex justify-end",children:[(0,s.jsx)(o(),{href:"/inspeksjoner/".concat(e.id),className:"text-blue-400 hover:text-blue-500 mr-4",children:(0,s.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.478 0-8.268-2.943-9.542-7z"})]})}),(0,s.jsx)("button",{className:"text-red-400 hover:text-red-500",onClick:()=>y(e.id),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id)})})]})})})]})})}},4519:(e,r,t)=>{Promise.resolve().then(t.bind(t,3262))},5695:(e,r,t)=>{"use strict";var s=t(8999);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(r,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var r=r=>e(e.s=r);e.O(0,[851,874,441,684,358],()=>r(4519)),_N_E=e.O()}]);