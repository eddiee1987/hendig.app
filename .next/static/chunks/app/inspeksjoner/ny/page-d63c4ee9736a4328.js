(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{2099:(e,r,t)=>{"use strict";t.d(r,{HK:()=>i,LY:()=>d,ND:()=>s,qi:()=>c,y9:()=>o});var a=t(851);let n="https://jntsodzdafscwksizfov.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",n),console.log("Supabase Anon Key:",l?"Set":"Not set"),n&&l||console.error("Supabase credentials are not set correctly in environment variables");let s=(0,a.UU)(n,l);async function o(){try{let{data:e,error:r}=await s.from("lager").select("navn, antall");if(r)return console.error("Error fetching lager:",r),{};let t={};return null==e||e.forEach(e=>{t[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),t}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function i(e){try{let{data:r,error:t}=await s.from("lager").select("id, navn");if(t)return void console.error("Error fetching lager for update:",t);for(let[t,a]of Object.entries(e)){let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),n=null==r?void 0:r.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===t);n?await s.from("lager").update({antall:Number(a)}).eq("id",n.id):await s.from("lager").insert([{navn:e,antall:Number(a)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function c(){try{let{data:e,error:r}=await s.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(r)return console.error("Error fetching lager historikk:",r),window.__supabaseLagerHistorikkError=r,[];return(e||[]).map(e=>{var r,t;return{created_at:e.created_at,navn:(null==(t=e.lager)||null==(r=t[0])?void 0:r.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function d(e){let{key:r,type:t,antall:a,kommentar:n}=e;try{let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null,o=0,{data:i}=await s.from("lager").select("id, antall").eq("navn",e).limit(1);if(i&&0!==i.length){if(l=i[0].id,o=i[0].antall,"inntak"===t)o+=a;else if("uttak"===t){if(i[0].antall<a)return{error:"Ikke nok p\xe5 lager for uttak"};o-=a}else"manuell"===t&&(o=a);let{error:e}=await s.from("lager").update({antall:o}).eq("id",l);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==t)return{error:"Fant ikke varen i lageret"};let{data:r,error:n}=await s.from("lager").insert([{navn:e,antall:Number(a)}]).select("id").single();if(n||!r)return{error:"Kunne ikke opprette ny vare"};l=r.id,o=Number(a)}let{error:c}=await s.from("lager_transactions").insert({lager_id:l,type:t,antall:a,kommentar:n});if(c)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},2523:(e,r,t)=>{"use strict";t.d(r,{p:()=>s});var a=t(5155),n=t(2115),l=t(9434);let s=n.forwardRef((e,r)=>{let{className:t,type:n,...s}=e;return(0,a.jsx)("input",{type:n,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...s})});s.displayName="Input"},4392:(e,r,t)=>{"use strict";t.d(r,{$:()=>g});var a=t(5155),n=t(2115);function l(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}var s=function(e){let r=function(e){let r=n.forwardRef((e,r)=>{let{children:t,...a}=e;if(n.isValidElement(t)){var s;let e,o,i=(s=t,(o=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(o=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),c=function(e,r){let t={...r};for(let a in r){let n=e[a],l=r[a];/^on[A-Z]/.test(a)?n&&l?t[a]=(...e)=>{l(...e),n(...e)}:n&&(t[a]=n):"style"===a?t[a]={...n,...l}:"className"===a&&(t[a]=[n,l].filter(Boolean).join(" "))}return{...e,...t}}(a,t.props);return t.type!==n.Fragment&&(c.ref=r?function(...e){return r=>{let t=!1,a=e.map(e=>{let a=l(e,r);return t||"function"!=typeof a||(t=!0),a});if(t)return()=>{for(let r=0;r<a.length;r++){let t=a[r];"function"==typeof t?t():l(e[r],null)}}}}(r,i):i),n.cloneElement(t,c)}return n.Children.count(t)>1?n.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=n.forwardRef((e,t)=>{let{children:l,...s}=e,o=n.Children.toArray(l),c=o.find(i);if(c){let e=c.props.children,l=o.map(r=>r!==c?r:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(r,{...s,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,l):null})}return(0,a.jsx)(r,{...s,ref:t,children:l})});return t.displayName=`${e}.Slot`,t}("Slot"),o=Symbol("radix.slottable");function i(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}var c=t(2596);let d=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,u=c.$;var m=t(9434);let p=((e,r)=>t=>{var a;if((null==r?void 0:r.variants)==null)return u(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:n,defaultVariants:l}=r,s=Object.keys(n).map(e=>{let r=null==t?void 0:t[e],a=null==l?void 0:l[e];if(null===r)return null;let s=d(r)||d(a);return n[e][s]}),o=t&&Object.entries(t).reduce((e,r)=>{let[t,a]=r;return void 0===a||(e[t]=a),e},{});return u(e,s,null==r||null==(a=r.compoundVariants)?void 0:a.reduce((e,r)=>{let{class:t,className:a,...n}=r;return Object.entries(n).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...l,...o}[r]):({...l,...o})[r]===t})?[...e,t,a]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)})("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),g=n.forwardRef((e,r)=>{let{className:t,variant:n,size:l,asChild:o=!1,...i}=e;return(0,a.jsx)(o?s:"button",{className:(0,m.cn)(p({variant:n,size:l,className:t})),ref:r,...i})});g.displayName="Button"},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},6695:(e,r,t)=>{"use strict";t.d(r,{Zp:()=>s});var a=t(5155),n=t(2115),l=t(9434);let s=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});s.displayName="Card",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...n})}).displayName="CardHeader",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})}).displayName="CardTitle",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",t),...n})}).displayName="CardDescription",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,l.cn)("p-6 pt-0",t),...n})}).displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},7256:(e,r,t)=>{Promise.resolve().then(t.bind(t,8642))},8642:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var a=t(5155),n=t(2115),l=t(5695),s=t(2099),o=t(4392),i=t(6695),c=t(2523),d=t(9434);let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});function m(){let e=(0,l.useRouter)(),[r,t]=(0,n.useState)([]),[d,m]=(0,n.useState)(!0),[p,g]=(0,n.useState)(null),[f,b]=(0,n.useState)(null),[h,x]=(0,n.useState)(""),[v,y]=(0,n.useState)(""),[j,k]=(0,n.useState)(""),[N,w]=(0,n.useState)(""),[S,C]=(0,n.useState)("planlagt"),[_,E]=(0,n.useState)(""),[R,A]=(0,n.useState)(""),[I,D]=(0,n.useState)(""),[P,U]=(0,n.useState)(""),[V,O]=(0,n.useState)(!1),[K,L]=(0,n.useState)([]),[F,J]=(0,n.useState)([]),[Z,z]=(0,n.useState)([]),[q,H]=(0,n.useState)([]);async function T(){try{m(!0);let{data:e,error:r}=await s.ND.from("abonnementer").select("id, etternavn, adresse, kommune");if(r){console.error("Error fetching customers:",r),g("Kunne ikke hente kunder");return}t(e||[])}catch(e){console.error("Unexpected error:",e),g("En uventet feil oppstod")}finally{m(!1)}}(0,n.useEffect)(()=>{T()},[]);let $=async r=>{if(r.preventDefault(),!h||!N||!_)return void b("Vennligst fyll ut alle p\xe5krevde felt");try{b("Lagrer inspeksjon...");try{await s.ND.storage.createBucket("inspeksjonsbilder",{public:!0})}catch(e){if(e instanceof Error&&!e.message.includes("Bucket already exists"))throw console.error("Error creating bucket:",e),Error("Kunne ikke opprette bilde-lager")}let r=[],t=[],a="inspeksjoner/".concat(h,"_").concat(Date.now());for(let e of K){let t="".concat(Date.now(),"-").concat(e.name),{error:n}=await s.ND.storage.from("inspeksjonsbilder").upload("".concat(a,"/for/").concat(t),e,{cacheControl:"3600",upsert:!1});if(n)throw console.error("Error uploading before image:",n),Error("Kunne ikke laste opp f\xf8r-bilde: ".concat(n.message));let{data:{publicUrl:l}}=s.ND.storage.from("inspeksjonsbilder").getPublicUrl("".concat(a,"/for/").concat(t));r.push(l)}for(let e of F){let r="".concat(Date.now(),"-").concat(e.name),{error:n}=await s.ND.storage.from("inspeksjonsbilder").upload("".concat(a,"/etter/").concat(r),e,{cacheControl:"3600",upsert:!1});if(n)throw console.error("Error uploading after image:",n),Error("Kunne ikke laste opp etter-bilde: ".concat(n.message));let{data:{publicUrl:l}}=s.ND.storage.from("inspeksjonsbilder").getPublicUrl("".concat(a,"/etter/").concat(r));t.push(l)}let{error:n}=await s.ND.from("inspections").insert([{customer_id:h,customer_name:v,customer_address:j,inspection_date:_,inspection_type:N,status:S,roof_condition:R,notes:I,inspector:P,before_images:r,after_images:t}]);if(n){console.error("Error saving inspection:",n),n.message.includes('relation "inspections" does not exist')||n.message.includes("does not exist")||"42P01"===n.code?b("Inspeksjonstabellen eksisterer ikke enn\xe5. Vennligst kj\xf8r migrasjonen f\xf8rst."):b("Kunne ikke lagre inspeksjon: ".concat(n.message));return}if("utf\xf8rt"===S&&("v\xe5rvedlikehold"===N||"h\xf8stvedlikehold"===N)){let e="v\xe5rvedlikehold"===N?"var":"host",{error:r}=await s.ND.from("abonnementer").update({[e]:"Ja"}).eq("id",h);r&&console.error("Error updating customer maintenance status:",r)}V&&console.log("SMS would be sent:",{to:"customer phone",message:"Vi kommer for \xe5 utf\xf8re ".concat(N," p\xe5 taket ditt den ").concat(_)}),b("Inspeksjon lagret!"),setTimeout(()=>{e.push("/inspeksjoner")},1500)}catch(e){console.error("Unexpected error:",e),b("En uventet feil oppstod")}};return d?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-400",children:"Laster kunder..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-white mb-6",children:"Ny inspeksjon"}),p&&(0,a.jsx)("div",{className:"bg-red-900/20 border border-red-800 text-red-400 px-4 py-3 rounded-xl mb-6",children:p}),f&&!f.includes("Kunne ikke")&&!f.includes("Vennligst")&&(0,a.jsx)("div",{className:"bg-green-900/20 border border-green-800 text-green-400 px-4 py-3 rounded-xl mb-6",children:f}),f&&(f.includes("Kunne ikke")||f.includes("Vennligst"))&&(0,a.jsx)("div",{className:"bg-red-900/20 border border-red-800 text-red-400 px-4 py-3 rounded-xl mb-6",children:f}),(0,a.jsxs)("form",{onSubmit:$,className:"space-y-6",children:[(0,a.jsxs)(i.Zp,{className:"p-6 bg-gray-800 border border-gray-700",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Kundeinformasjon"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Velg kunde"}),(0,a.jsxs)("select",{className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-white",value:h,onChange:e=>{let t=e.target.value;if(x(t),t){let e=r.find(e=>e.id===t);e&&(y(e.etternavn),k(e.adresse))}else y(""),k("")},required:!0,children:[(0,a.jsx)("option",{value:"",children:"Velg kunde..."}),r.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.etternavn," - ",e.adresse,", ",e.kommune]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Type inspeksjon"}),(0,a.jsxs)("select",{className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-white",value:N,onChange:e=>w(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Velg type..."}),(0,a.jsx)("option",{value:"v\xe5rvedlikehold",children:"V\xe5rvedlikehold"}),(0,a.jsx)("option",{value:"h\xf8stvedlikehold",children:"H\xf8stvedlikehold"}),(0,a.jsx)("option",{value:"rehabilitering",children:"Rehabilitering"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Status"}),(0,a.jsxs)("select",{className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-white",value:S,onChange:e=>C(e.target.value),children:[(0,a.jsx)("option",{value:"planlagt",children:"Planlagt"}),(0,a.jsx)("option",{value:"utf\xf8rt",children:"Utf\xf8rt"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Dato"}),(0,a.jsx)(c.p,{type:"date",value:_,onChange:e=>E(e.target.value),required:!0,className:"bg-gray-700 border-gray-600 text-white"})]})]})]}),"utf\xf8rt"===S&&(0,a.jsxs)(i.Zp,{className:"p-6 bg-gray-800 border border-gray-700",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Inspeksjonsdetaljer"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Taktilstand"}),(0,a.jsxs)("select",{className:"w-full p-2 border border-gray-600 rounded bg-gray-700 text-white",value:R,onChange:e=>A(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Velg tilstand..."}),(0,a.jsx)("option",{value:"god",children:"God"}),(0,a.jsx)("option",{value:"normal",children:"Normal"}),(0,a.jsx)("option",{value:"d\xe5rlig",children:"D\xe5rlig"}),(0,a.jsx)("option",{value:"kritisk",children:"Kritisk"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Inspekt\xf8r"}),(0,a.jsx)(c.p,{type:"text",value:P,onChange:e=>U(e.target.value),placeholder:"Navn p\xe5 inspekt\xf8r",className:"bg-gray-700 border-gray-600 text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"F\xf8r-bilder"}),(0,a.jsx)(c.p,{type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){let r=Array.from(e.target.files);L(e=>[...e,...r]);let t=r.map(e=>URL.createObjectURL(e));z(e=>[...e,...t])}},className:"bg-gray-700 border-gray-600 text-white"}),Z.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:Z.map((e,r)=>(0,a.jsx)("img",{src:e,alt:"F\xf8r-bilde ".concat(r+1),className:"w-full h-24 object-cover rounded"},r))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Etter-bilder"}),(0,a.jsx)(c.p,{type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){let r=Array.from(e.target.files);J(e=>[...e,...r]);let t=r.map(e=>URL.createObjectURL(e));H(e=>[...e,...t])}},className:"bg-gray-700 border-gray-600 text-white"}),q.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:q.map((e,r)=>(0,a.jsx)("img",{src:e,alt:"Etter-bilde ".concat(r+1),className:"w-full h-24 object-cover rounded"},r))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Notater"}),(0,a.jsx)(u,{value:I,onChange:e=>D(e.target.value),placeholder:"Beskriv takets tilstand og eventuelle problemer...",rows:4,className:"bg-gray-700 border-gray-600 text-white"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"sendSms",checked:V,onChange:e=>O(e.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600"}),(0,a.jsx)("label",{htmlFor:"sendSms",className:"text-gray-300",children:"Send SMS til kunde om utf\xf8rt vedlikehold"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)(o.$,{type:"button",variant:"outline",onClick:()=>e.push("/inspeksjoner"),className:"border-gray-600 text-gray-300 hover:bg-gray-700",children:"Avbryt"}),(0,a.jsx)(o.$,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"planlagt"===S?"Planlegg inspeksjon":"Registrer utf\xf8rt inspeksjon"})]})]})]})})}u.displayName="Textarea"},9434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l});var a=t(2596),n=t(9688);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,a.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[851,277,441,684,358],()=>r(7256)),_N_E=e.O()}]);