(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{2099:(e,r,t)=>{"use strict";t.d(r,{HK:()=>o,LY:()=>d,ND:()=>s,qi:()=>c,y9:()=>i});var a=t(851);let n="https://jntsodzdafscwksizfov.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",n),console.log("Supabase Anon Key:",l?"Set":"Not set"),n&&l||console.error("Supabase credentials are not set correctly in environment variables");let s=(0,a.UU)(n,l);async function i(){try{let{data:e,error:r}=await s.from("lager").select("navn, antall");if(r)return console.error("Error fetching lager:",r),{};let t={};return null==e||e.forEach(e=>{t[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),t}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function o(e){try{let{data:r,error:t}=await s.from("lager").select("id, navn");if(t)return void console.error("Error fetching lager for update:",t);for(let[t,a]of Object.entries(e)){let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),n=null==r?void 0:r.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===t);n?await s.from("lager").update({antall:Number(a)}).eq("id",n.id):await s.from("lager").insert([{navn:e,antall:Number(a)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function c(){try{let{data:e,error:r}=await s.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(r)return console.error("Error fetching lager historikk:",r),window.__supabaseLagerHistorikkError=r,[];return(e||[]).map(e=>{var r,t;return{created_at:e.created_at,navn:(null==(t=e.lager)||null==(r=t[0])?void 0:r.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function d(e){let{key:r,type:t,antall:a,kommentar:n}=e;try{let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null,i=0,{data:o}=await s.from("lager").select("id, antall").eq("navn",e).limit(1);if(o&&0!==o.length){if(l=o[0].id,i=o[0].antall,"inntak"===t)i+=a;else if("uttak"===t){if(o[0].antall<a)return{error:"Ikke nok p\xe5 lager for uttak"};i-=a}else"manuell"===t&&(i=a);let{error:e}=await s.from("lager").update({antall:i}).eq("id",l);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==t)return{error:"Fant ikke varen i lageret"};let{data:r,error:n}=await s.from("lager").insert([{navn:e,antall:Number(a)}]).select("id").single();if(n||!r)return{error:"Kunne ikke opprette ny vare"};l=r.id,i=Number(a)}let{error:c}=await s.from("lager_transactions").insert({lager_id:l,type:t,antall:a,kommentar:n});if(c)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},2996:(e,r,t)=>{Promise.resolve().then(t.bind(t,3856))},3856:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var a=t(5155),n=t(2115),l=t(5695),s=t(2099),i=t(6874),o=t.n(i),c=t(4392),d=t(9509);function u(){var e,r,t,i,u;let m=(0,l.useParams)();(0,l.useRouter)();let[p,f]=(0,n.useState)(null),[g,h]=(0,n.useState)(!0),[x,b]=(0,n.useState)(null),[v,j]=(0,n.useState)(!1),[y,N]=(0,n.useState)([]),[k,w]=(0,n.useState)([]),[_,E]=(0,n.useState)([]),[A,I]=(0,n.useState)([]);async function S(){try{h(!0);let{data:e,error:r}=await s.ND.from("inspections").select("\n          *,\n          abonnementer:customer_id (etternavn),\n          before_images,\n          after_images\n        ").eq("id",m.id).single();if(r)throw r;f(e)}catch(e){console.error("Error fetching inspection:",e),b("Kunne ikke hente inspeksjon")}finally{h(!1)}}if((0,n.useEffect)(()=>{S()},[m.id]),g)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto text-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-400",children:"Laster inspeksjon..."})]})});if(x||!p)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"bg-red-900/20 text-red-400 p-6 rounded-xl text-center",children:x||"Inspeksjon ikke funnet"}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)(o(),{href:"/inspeksjoner",children:(0,a.jsx)(c.$,{variant:"outline",children:"Tilbake til liste"})})})]})});return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8 ml-64",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-white",children:["Inspeksjon for ",(null==(e=p.abonnementer)?void 0:e.etternavn)||p.customer_name||"Ukjent kunde"]}),(0,a.jsxs)("p",{className:"text-gray-400 mt-2",children:[new Date(p.inspection_date).toLocaleDateString("nb-NO")," â€¢",(0,a.jsx)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium ".concat("planlagt"===p.status?"bg-yellow-900/50 text-yellow-400":"bg-green-900/50 text-green-400"),children:p.status})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.$,{variant:"outline",onClick:()=>j(!1),children:"Avbryt"}),(0,a.jsx)(c.$,{onClick:P,disabled:g,children:g?"Lagrer...":"Lagre endringer"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.$,{variant:"outline",onClick:()=>j(!0),children:"Rediger"}),(0,a.jsx)(o(),{href:"/inspeksjoner",children:(0,a.jsx)(c.$,{variant:"outline",children:"Tilbake til liste"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2 bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Detaljer"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Kunde"}),(0,a.jsx)("p",{className:"text-white",children:(null==(r=p.abonnementer)?void 0:r.etternavn)||p.customer_name||"Ukjent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Adresse"}),(0,a.jsx)("p",{className:"text-white",children:p.customer_address})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Dato"}),(0,a.jsx)("p",{className:"text-white",children:new Date(p.inspection_date).toLocaleDateString("nb-NO")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Type"}),(0,a.jsx)("p",{className:"text-white capitalize",children:p.inspection_type})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Inspekt\xf8r"}),(0,a.jsx)("p",{className:"text-white",children:p.inspector||"Ikke angitt"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Takstatus"}),(0,a.jsx)("p",{className:"text-white",children:p.roof_condition||"Ikke angitt"})]})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("p",{className:"text-gray-400",children:"Notater"}),(0,a.jsx)("p",{className:"text-white mt-2 whitespace-pre-line",children:p.notes||"Ingen notater"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Bilder"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-gray-400 mb-2",children:"F\xf8r-bilder"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[null==(t=p.before_images)?void 0:t.map((e,r)=>{let t=e.startsWith("http")?e:"https://".concat(d.env.NEXT_PUBLIC_SUPABASE_PROJECT_ID,".supabase.co/storage/v1/object/public/inspeksjonsbilder/").concat(e);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:t,alt:"F\xf8r-bilde ".concat(r+1),className:"w-full h-32 object-cover rounded",onError:e=>{e.target.src="/image-placeholder.png"}}),v&&(0,a.jsx)("button",{className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center",onClick:()=>D("before",r),children:"\xd7"})]},"before-".concat(r))}),_.map((e,r)=>(0,a.jsx)("img",{src:e,alt:"Midlertidig f\xf8r-bilde ".concat(r+1),className:"w-full h-32 object-cover rounded"},"temp-before-".concat(r)))]}),v&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>C(e,"before"),className:"text-sm text-gray-400"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-gray-400 mb-2",children:"Etter-bilder"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[null==(i=p.after_images)?void 0:i.map((e,r)=>{let t=e.startsWith("http")?e:"https://".concat(d.env.NEXT_PUBLIC_SUPABASE_PROJECT_ID,".supabase.co/storage/v1/object/public/inspeksjonsbilder/").concat(e);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:t,alt:"Etter-bilde ".concat(r+1),className:"w-full h-32 object-cover rounded",onError:e=>{e.target.src="/image-placeholder.png"}}),v&&(0,a.jsx)("button",{className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center",onClick:()=>D("after",r),children:"\xd7"})]},"after-".concat(r))}),A.map((e,r)=>(0,a.jsx)("img",{src:e,alt:"Midlertidig etter-bilde ".concat(r+1),className:"w-full h-32 object-cover rounded"},"temp-after-".concat(r)))]}),v&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>C(e,"after"),className:"text-sm text-gray-400"})}),!(null==(u=p.after_images)?void 0:u.length)&&!A.length&&(0,a.jsx)("p",{className:"text-gray-400",children:"Ingen bilder lagt til"})]})]})]})]})});async function C(e,r){if(e.target.files){let t=Array.from(e.target.files);"before"===r?(N(e=>[...e,...t]),E(e=>[...e,...t.map(e=>URL.createObjectURL(e))])):(w(e=>[...e,...t]),I(e=>[...e,...t.map(e=>URL.createObjectURL(e))]))}}function D(e,r){if("before"===e){let e=[...(null==p?void 0:p.before_images)||[]];e.splice(r,1),f(r=>r?{...r,before_images:e}:null)}else{let e=[...(null==p?void 0:p.after_images)||[]];e.splice(r,1),f(r=>r?{...r,after_images:e}:null)}}async function P(){try{h(!0);try{await s.ND.storage.createBucket("inspeksjonsbilder",{public:!0})}catch(e){if(e instanceof Error&&!e.message.includes("Bucket already exists"))throw console.error("Error creating bucket:",e),Error("Kunne ikke opprette bilde-lager")}let e="inspeksjoner/".concat(null==p?void 0:p.id),r=[...(null==p?void 0:p.before_images)||[]],t=[...(null==p?void 0:p.after_images)||[]];for(let t of y){let a="".concat(Date.now(),"-").concat(t.name),{error:n}=await s.ND.storage.from("inspeksjonsbilder").upload("".concat(e,"/for/").concat(a),t,{cacheControl:"3600",upsert:!1});if(n)throw console.error("Error uploading before image:",n),Error("Kunne ikke laste opp f\xf8r-bilde: ".concat(n.message));let{data:{publicUrl:l}}=s.ND.storage.from("inspeksjonsbilder").getPublicUrl("".concat(e,"/for/").concat(a));r.push(l)}for(let r of k){let a="".concat(Date.now(),"-").concat(r.name),{error:n}=await s.ND.storage.from("inspeksjonsbilder").upload("".concat(e,"/etter/").concat(a),r,{cacheControl:"3600",upsert:!1});if(n)throw console.error("Error uploading after image:",n),Error("Kunne ikke laste opp etter-bilde: ".concat(n.message));let{data:{publicUrl:l}}=s.ND.storage.from("inspeksjonsbilder").getPublicUrl("".concat(e,"/etter/").concat(a));t.push(l)}let{data:a,error:n}=await s.ND.from("inspections").update({before_images:r,after_images:t}).eq("id",m.id).select();if(n)throw console.error("Supabase update error:",n),Error("Databasefeil: ".concat(n.message));j(!1),N([]),w([]),E([]),I([]),f(a[0])}catch(e){console.error("Error saving changes:",e),b(e instanceof Error?e.message:"Kunne ikke lagre endringer")}finally{h(!1)}}}},4392:(e,r,t)=>{"use strict";t.d(r,{$:()=>f});var a=t(5155),n=t(2115);function l(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}var s=function(e){let r=function(e){let r=n.forwardRef((e,r)=>{let{children:t,...a}=e;if(n.isValidElement(t)){var s;let e,i,o=(s=t,(i=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(i=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),c=function(e,r){let t={...r};for(let a in r){let n=e[a],l=r[a];/^on[A-Z]/.test(a)?n&&l?t[a]=(...e)=>{l(...e),n(...e)}:n&&(t[a]=n):"style"===a?t[a]={...n,...l}:"className"===a&&(t[a]=[n,l].filter(Boolean).join(" "))}return{...e,...t}}(a,t.props);return t.type!==n.Fragment&&(c.ref=r?function(...e){return r=>{let t=!1,a=e.map(e=>{let a=l(e,r);return t||"function"!=typeof a||(t=!0),a});if(t)return()=>{for(let r=0;r<a.length;r++){let t=a[r];"function"==typeof t?t():l(e[r],null)}}}}(r,o):o),n.cloneElement(t,c)}return n.Children.count(t)>1?n.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=n.forwardRef((e,t)=>{let{children:l,...s}=e,i=n.Children.toArray(l),c=i.find(o);if(c){let e=c.props.children,l=i.map(r=>r!==c?r:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(r,{...s,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,l):null})}return(0,a.jsx)(r,{...s,ref:t,children:l})});return t.displayName=`${e}.Slot`,t}("Slot"),i=Symbol("radix.slottable");function o(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}var c=t(2596);let d=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,u=c.$;var m=t(9434);let p=((e,r)=>t=>{var a;if((null==r?void 0:r.variants)==null)return u(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:n,defaultVariants:l}=r,s=Object.keys(n).map(e=>{let r=null==t?void 0:t[e],a=null==l?void 0:l[e];if(null===r)return null;let s=d(r)||d(a);return n[e][s]}),i=t&&Object.entries(t).reduce((e,r)=>{let[t,a]=r;return void 0===a||(e[t]=a),e},{});return u(e,s,null==r||null==(a=r.compoundVariants)?void 0:a.reduce((e,r)=>{let{class:t,className:a,...n}=r;return Object.entries(n).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...l,...i}[r]):({...l,...i})[r]===t})?[...e,t,a]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)})("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),f=n.forwardRef((e,r)=>{let{className:t,variant:n,size:l,asChild:i=!1,...o}=e;return(0,a.jsx)(i?s:"button",{className:(0,m.cn)(p({variant:n,size:l,className:t})),ref:r,...o})});f.displayName="Button"},5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},9434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l});var a=t(2596),n=t(9688);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,a.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[851,874,277,441,684,358],()=>r(2996)),_N_E=e.O()}]);