(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[638],{2099:(e,r,t)=>{"use strict";t.d(r,{HK:()=>o,LY:()=>d,ND:()=>s,qi:()=>c,y9:()=>i});var a=t(851);let l="https://jntsodzdafscwksizfov.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpudHNvZHpkYWZzY3drc2l6Zm92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NTU1NDAsImV4cCI6MjA1OTEzMTU0MH0.bHJS17KYKP4n2Abs0rp2oO0pFBGW3GorNhsJFyDljR8";console.log("Supabase URL:",l),console.log("Supabase Anon Key:",n?"Set":"Not set"),l&&n||console.error("Supabase credentials are not set correctly in environment variables");let s=(0,a.UU)(l,n);async function i(){try{let{data:e,error:r}=await s.from("lager").select("navn, antall");if(r)return console.error("Error fetching lager:",r),{};let t={};return null==e||e.forEach(e=>{t[e.navn.toLowerCase().replaceAll(" ","_").replaceAll("\xe5","a").replaceAll("\xe6","ae").replaceAll("\xf8","o")]=e.antall}),t}catch(e){return console.error("Unexpected error fetching lager:",e),{}}}async function o(e){try{let{data:r,error:t}=await s.from("lager").select("id, navn");if(t)return void console.error("Error fetching lager for update:",t);for(let[t,a]of Object.entries(e)){let e=t.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),l=null==r?void 0:r.find(e=>e.navn.toLowerCase().replaceAll(" ","_")===t);l?await s.from("lager").update({antall:Number(a)}).eq("id",l.id):await s.from("lager").insert([{navn:e,antall:Number(a)}])}}catch(e){console.error("Unexpected error updating lager:",e)}}async function c(){try{let{data:e,error:r}=await s.from("lager_transactions").select("created_at, type, antall, kommentar, lager_id, lager:lager_id(navn)").order("created_at",{ascending:!1}).limit(100);if(r)return console.error("Error fetching lager historikk:",r),window.__supabaseLagerHistorikkError=r,[];return(e||[]).map(e=>{var r,t;return{created_at:e.created_at,navn:(null==(t=e.lager)||null==(r=t[0])?void 0:r.navn)||"",type:e.type,antall:e.antall,kommentar:e.kommentar||""}})}catch(e){return console.error("Unexpected error fetching lager historikk:",e),[]}}async function d(e){let{key:r,type:t,antall:a,kommentar:l}=e;try{let e=r.replaceAll("_"," ").replaceAll("ae","\xe6").replaceAll("o","\xf8").replaceAll("a","\xe5"),n=null,i=0,{data:o}=await s.from("lager").select("id, antall").eq("navn",e).limit(1);if(o&&0!==o.length){if(n=o[0].id,i=o[0].antall,"inntak"===t)i+=a;else if("uttak"===t){if(o[0].antall<a)return{error:"Ikke nok p\xe5 lager for uttak"};i-=a}else"manuell"===t&&(i=a);let{error:e}=await s.from("lager").update({antall:i}).eq("id",n);if(e)return{error:"Kunne ikke oppdatere lagerbeholdning"}}else{if("manuell"!==t)return{error:"Fant ikke varen i lageret"};let{data:r,error:l}=await s.from("lager").insert([{navn:e,antall:Number(a)}]).select("id").single();if(l||!r)return{error:"Kunne ikke opprette ny vare"};n=r.id,i=Number(a)}let{error:c}=await s.from("lager_transactions").insert({lager_id:n,type:t,antall:a,kommentar:l});if(c)return{error:"Kunne ikke registrere transaksjon"};return{success:!0}}catch(e){return{error:"Uventet feil ved registrering"}}}},4392:(e,r,t)=>{"use strict";t.d(r,{$:()=>p});var a=t(5155),l=t(2115);function n(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}var s=function(e){let r=function(e){let r=l.forwardRef((e,r)=>{let{children:t,...a}=e;if(l.isValidElement(t)){var s;let e,i,o=(s=t,(i=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.ref:(i=(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?s.props.ref:s.props.ref||s.ref),c=function(e,r){let t={...r};for(let a in r){let l=e[a],n=r[a];/^on[A-Z]/.test(a)?l&&n?t[a]=(...e)=>{n(...e),l(...e)}:l&&(t[a]=l):"style"===a?t[a]={...l,...n}:"className"===a&&(t[a]=[l,n].filter(Boolean).join(" "))}return{...e,...t}}(a,t.props);return t.type!==l.Fragment&&(c.ref=r?function(...e){return r=>{let t=!1,a=e.map(e=>{let a=n(e,r);return t||"function"!=typeof a||(t=!0),a});if(t)return()=>{for(let r=0;r<a.length;r++){let t=a[r];"function"==typeof t?t():n(e[r],null)}}}}(r,o):o),l.cloneElement(t,c)}return l.Children.count(t)>1?l.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=l.forwardRef((e,t)=>{let{children:n,...s}=e,i=l.Children.toArray(n),c=i.find(o);if(c){let e=c.props.children,n=i.map(r=>r!==c?r:l.Children.count(e)>1?l.Children.only(null):l.isValidElement(e)?e.props.children:null);return(0,a.jsx)(r,{...s,ref:t,children:l.isValidElement(e)?l.cloneElement(e,void 0,n):null})}return(0,a.jsx)(r,{...s,ref:t,children:n})});return t.displayName=`${e}.Slot`,t}("Slot"),i=Symbol("radix.slottable");function o(e){return l.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}var c=t(2596);let d=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,u=c.$;var m=t(9434);let g=((e,r)=>t=>{var a;if((null==r?void 0:r.variants)==null)return u(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:l,defaultVariants:n}=r,s=Object.keys(l).map(e=>{let r=null==t?void 0:t[e],a=null==n?void 0:n[e];if(null===r)return null;let s=d(r)||d(a);return l[e][s]}),i=t&&Object.entries(t).reduce((e,r)=>{let[t,a]=r;return void 0===a||(e[t]=a),e},{});return u(e,s,null==r||null==(a=r.compoundVariants)?void 0:a.reduce((e,r)=>{let{class:t,className:a,...l}=r;return Object.entries(l).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...n,...i}[r]):({...n,...i})[r]===t})?[...e,t,a]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)})("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),p=l.forwardRef((e,r)=>{let{className:t,variant:l,size:n,asChild:i=!1,...o}=e;return(0,a.jsx)(i?s:"button",{className:(0,m.cn)(g({variant:l,size:n,className:t})),ref:r,...o})});p.displayName="Button"},4736:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(5155),l=t(2115),n=t(2099),s=t(6695),i=t(4392);let o=[{name:"Impregnert staur",key:"impregnert_staur"},{name:"Granstaur",key:"granstaur"},{name:"Skier",key:"skier"},{name:"St\xe5ltr\xe5d",key:"staltrad"}];function c(){let[e,r]=(0,l.useState)({}),[t,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(!1),[m,g]=(0,l.useState)({}),[p,f]=(0,l.useState)([]),[y,h]=(0,l.useState)({key:o[0].key,type:"inntak",antall:1,kommentar:""}),[x,b]=(0,l.useState)(!1),[v,k]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=async()=>{f(await (0,n.qi)()||[])};(async()=>{c(!0);let e=await (0,n.y9)();r(e||{}),g(e||{}),c(!1)})(),e()},[]);let N=(e,r)=>{g(t=>({...t,[e]:Number(r)}))},j=async()=>{let t=Object.keys(m).filter(r=>m[r]!==e[r]);for(let s of(await (0,n.HK)(m),r(m),u(!1),t)){var a,l;let r=null!=(a=e[s])?a:0,t=null!=(l=m[s])?l:0,i=t-r;if(0!==i){if(!o.find(e=>e.key===s))continue;let{data:e,error:a}=await (0,n.y9)();await (0,n.LY)({key:s,type:"manuell",antall:i,kommentar:"Manuell endring fra ".concat(r," til ").concat(t," via rediger-knapp")})}}f(await (0,n.qi)()||[])},w=async e=>{e.preventDefault(),b(!0),k("");try{let e=await (0,n.LY)({...y,type:y.type});(null==e?void 0:e.error)&&k(e.error);let t=await (0,n.y9)();r(t||{}),g(t||{});let a=await (0,n.qi)();f(a||[]),h({...y,antall:1,kommentar:""})}catch(e){k("Uventet feil ved registrering")}finally{b(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 p-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-10",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"Lagerbeholdning"}),(0,a.jsx)("p",{className:"text-gray-400 mb-8",children:"Hold oversikt, rediger og registrer transaksjoner p\xe5 lageret."}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6",children:o.map(r=>{var t,l;return(0,a.jsxs)(s.Zp,{className:"p-6 flex flex-col items-center bg-gray-800 border border-gray-700",children:[(0,a.jsx)("span",{className:"text-lg text-gray-300 mb-2",children:r.name}),d?(0,a.jsx)("input",{type:"number",className:"w-20 text-center rounded bg-gray-700 text-white border border-gray-600 focus:ring-blue-500 focus:border-blue-500",value:null!=(t=m[r.key])?t:0,onChange:e=>N(r.key,e.target.value),min:0}):(0,a.jsx)("span",{className:"text-3xl font-bold text-white",children:null!=(l=e[r.key])?l:0})]},r.key)})}),(0,a.jsxs)("div",{className:"flex gap-4 mt-4",children:[d?(0,a.jsx)(i.$,{onClick:j,className:"bg-blue-600 hover:bg-blue-700",children:"Lagre"}):(0,a.jsx)(i.$,{onClick:()=>u(!0),className:"bg-gray-700 hover:bg-gray-600",children:"Rediger"}),d&&(0,a.jsx)(i.$,{onClick:()=>{u(!1),g(e)},className:"bg-gray-500 hover:bg-gray-400",children:"Avbryt"})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 mt-10",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Registrer transaksjon"}),(0,a.jsxs)("form",{onSubmit:w,className:"flex flex-col md:flex-row gap-4 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-300 mb-1",children:"Vare"}),(0,a.jsx)("select",{className:"rounded bg-gray-700 text-white border border-gray-600",value:y.key,onChange:e=>h(r=>({...r,key:e.target.value})),children:o.map(e=>(0,a.jsx)("option",{value:e.key,children:e.name},e.key))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-300 mb-1",children:"Type"}),(0,a.jsxs)("select",{className:"rounded bg-gray-700 text-white border border-gray-600",value:y.type,onChange:e=>h(r=>({...r,type:e.target.value})),children:[(0,a.jsx)("option",{value:"inntak",children:"Inntak"}),(0,a.jsx)("option",{value:"uttak",children:"Uttak"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-gray-300 mb-1",children:"Antall"}),(0,a.jsx)("input",{type:"number",className:"w-24 rounded bg-gray-700 text-white border border-gray-600",value:y.antall,min:1,onChange:e=>h(r=>({...r,antall:Number(e.target.value)})),required:!0})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-gray-300 mb-1",children:"Kommentar"}),(0,a.jsx)("input",{type:"text",className:"w-full rounded bg-gray-700 text-white border border-gray-600",value:y.kommentar,onChange:e=>h(r=>({...r,kommentar:e.target.value})),placeholder:"Valgfritt"})]}),(0,a.jsx)(i.$,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 min-w-[120px]",disabled:x,children:x?"Lagrer...":"Registrer"})]}),v&&(0,a.jsx)("p",{className:"text-red-400 mt-2",children:v})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 mt-10",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Lagerhistorikk"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full text-left text-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"py-2",children:"Dato"}),(0,a.jsx)("th",{className:"py-2",children:"Vare"}),(0,a.jsx)("th",{className:"py-2",children:"Type"}),(0,a.jsx)("th",{className:"py-2",children:"Antall"}),(0,a.jsx)("th",{className:"py-2",children:"Kommentar"})]})}),(0,a.jsxs)("tbody",{children:[p.map((e,r)=>(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("td",{className:"py-2",children:new Date(e.created_at).toLocaleString("nb-NO")}),(0,a.jsx)("td",{className:"py-2",children:e.navn}),(0,a.jsx)("td",{className:"py-2",children:"inntak"===e.type?"Inntak":"Uttak"}),(0,a.jsx)("td",{className:"py-2",children:e.antall}),(0,a.jsx)("td",{className:"py-2",children:e.kommentar})]},r)),0===p.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"text-center py-4 text-gray-500",children:"Ingen historikk funnet"})})]})]})})]})]})})}},6561:(e,r,t)=>{Promise.resolve().then(t.bind(t,4736))},6695:(e,r,t)=>{"use strict";t.d(r,{Zp:()=>s});var a=t(5155),l=t(2115),n=t(9434);let s=l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...l})});s.displayName="Card",l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...l})}).displayName="CardHeader",l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...l})}).displayName="CardTitle",l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...l})}).displayName="CardDescription",l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...l})}).displayName="CardContent",l.forwardRef((e,r)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...l})}).displayName="CardFooter"},9434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var a=t(2596),l=t(9688);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,l.QP)((0,a.$)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[851,277,441,684,358],()=>r(6561)),_N_E=e.O()}]);