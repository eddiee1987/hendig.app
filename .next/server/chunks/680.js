"use strict";exports.id=680,exports.ids=[680],exports.modules={93996:(e,t,r)=>{r.d(t,{JQ:()=>a,Ub:()=>c,Z4:()=>d,gA:()=>l,ui:()=>i,vr:()=>n,xx:()=>o});var s=r(16391);async function a(){let{data:e,error:t}=await s.ND.from("projects").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching projects:",t),t;return e||[]}async function l(e){console.log("Creating project with data:",e);try{console.log("Supabase client:",s.ND);let{data:t,error:r}=await s.ND.from("projects").select("id").limit(1);if(r)throw console.error("Error checking projects table:",r),Error(`Table check failed: ${r.message}`);console.log("Table check result:",t);let{data:a,error:l}=await s.ND.from("projects").insert([e]).select();if(l)throw console.error("Error creating project:",l),Error(`Insert failed: ${l.message}`);return console.log("Project created successfully:",a),a?.[0]}catch(e){throw console.error("Exception in createProject:",e),e}}async function n(e,t){console.log("Updating project with id:",e,"and data:",t);try{let{data:r,error:a}=await s.ND.from("projects").update(t).eq("id",e).select();if(a)throw console.error(`Error updating project with id ${e}:`,a),a;return console.log("Project updated successfully:",r),r?.[0]}catch(t){throw console.error(`Exception in updateProject for id ${e}:`,t),t}}async function o(e){let{error:t}=await s.ND.from("projects").delete().eq("id",e);if(t)throw console.error(`Error deleting project with id ${e}:`,t),t;return!0}async function i(){let{data:e,error:t}=await s.ND.from("scheduled_projects").select(`
      *,
      projects:project_id (*)
    `).order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled projects:",t),t;return e||[]}async function d(e,t){let{data:r,error:a}=await s.ND.from("scheduled_projects").insert([{project_id:e,scheduled_date:t}]).select();if(a)throw console.error(`Error scheduling project ${e} for date ${t}:`,a),a;return r?.[0]}async function c(e,t){let{error:r}=await s.ND.from("scheduled_projects").delete().eq("project_id",e).eq("scheduled_date",t);if(r)throw console.error(`Error unscheduling project ${e} for date ${t}:`,r),r;return!0}},94680:(e,t,r)=>{r.d(t,{A:()=>x});var s=r(60687),a=r(43210),l=r(2969);let n=a.forwardRef(function({title:e,titleId:t,...r},s){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}),o=a.forwardRef(function({title:e,titleId:t,...r},s){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}),i=a.forwardRef(function({title:e,titleId:t,...r},s){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},r),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});var d=r(93996),c=r(98980),m=r(37590);function x({projects:e,abonnements:t,inspections:r}){let[x,h]=(0,a.useState)("month"),[u,g]=(0,a.useState)(new Date),[f,b]=(0,a.useState)([]),[p,y]=(0,a.useState)([]),[j,v]=(0,a.useState)([]),[w,N]=(0,a.useState)("all"),[k,D]=(0,a.useState)(!1),[S,$]=(0,a.useState)(null),[E,I]=(0,a.useState)(null),[O,_]=(0,a.useState)(null),[C,L]=(0,a.useState)(null),[A,T]=(0,a.useState)(!0),[R,F]=(0,a.useState)("projects"),M=(0,a.useRef)(0),P=(0,a.useRef)(null),U=e=>["Man","Tirs","Ons","Tors","Fre","L\xf8r","S\xf8n"][e],V=e=>{$(e)},q=(e,t)=>{e.preventDefault()},z=e=>{e.preventDefault(),M.current++},K=e=>{e.preventDefault(),M.current--},W=async(e,t)=>{e.preventDefault(),M.current=0;let r=t.toISOString().split("T")[0];if(S){if(p.some(e=>e.id===S.id&&e.scheduledDate===r))return void $(null);try{let e=await (0,d.Z4)(S.id,r);if(e){let t={...S,scheduledDate:r,scheduledId:e.id};y([...p,t]),m.oR.success("Prosjekt planlagt")}}catch(e){console.error("Error scheduling project:",e),m.oR.error("Kunne ikke planlegge prosjekt")}finally{$(null)}}if(E){if(!E.id){m.oR.error("Ugyldig vedlikeholdsavtale - mangler ID"),I(null);return}if(j.some(e=>e.id===E.id&&e.scheduledDate===r))return void I(null);try{console.log("Attempting to schedule abonnement:",{id:E.id,date:r});let e=await (0,c.lt)(E.id,r);if(e){console.log("Successfully scheduled abonnement:",e);let t={...E,scheduledDate:r,scheduledId:e.id};v([...j,t]),m.oR.success("Vedlikeholdsavtale planlagt")}else console.error("No result returned from scheduleAbonnement"),m.oR.error("Ingen data returnert fra server")}catch(e){console.error("Detailed error scheduling abonnement:",{error:e instanceof Error?e.message:e,stack:e instanceof Error?e.stack:void 0,abonnementId:E.id,date:r}),e instanceof Error?e.message.includes("JWT expired")||e.message.includes("Invalid API key")?m.oR.error("Autentiseringsfeil - sjekk API-n\xf8kkel"):e.message.includes("foreign key constraint")?m.oR.error("Ugyldig vedlikeholdsavtale-ID"):m.oR.error(`Feil ved planlegging: ${e.message}`):m.oR.error("Ukjent feil ved planlegging")}finally{I(null)}}},B=async(e,t)=>{try{await (0,d.Ub)(e,t),y(p.filter(r=>r.id!==e||r.scheduledDate!==t)),m.oR.success("Prosjekt fjernet fra kalender")}catch(e){console.error("Error removing project from calendar:",e),m.oR.error("Kunne ikke fjerne prosjekt fra kalender")}},Z=async(e,t)=>{try{await (0,c.NA)(e,t),v(j.filter(r=>r.id!==e||r.scheduledDate!==t)),m.oR.success("Vedlikeholdsavtale fjernet fra kalender")}catch(e){console.error("Error removing abonnement from calendar:",e),m.oR.error("Kunne ikke fjerne vedlikeholdsavtale fra kalender")}},J="all"===w?e:e.filter(e=>e.status===w);return(0,s.jsx)("div",{className:"bg-gray-900 rounded-xl border border-gray-800",children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-800",children:[(0,s.jsxs)("button",{className:`px-4 py-3 text-sm font-medium flex items-center ${"month"===x?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"}`,onClick:()=>h("month"),children:[(0,s.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"M\xe5ned"]}),(0,s.jsxs)("button",{className:`px-4 py-3 text-sm font-medium flex items-center ${"week"===x?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"}`,onClick:()=>h("week"),children:[(0,s.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Uke"]}),(0,s.jsxs)("button",{className:`px-4 py-3 text-sm font-medium flex items-center ${"day"===x?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"}`,onClick:()=>h("day"),children:[(0,s.jsx)(l.A,{className:"w-4 h-4 mr-2"}),"Dag"]})]}),(0,s.jsxs)("div",{className:"flex flex-1",children:[(0,s.jsxs)("div",{className:"w-1/4 border-r border-gray-800 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-700",children:[(0,s.jsx)("button",{className:`flex-1 px-4 py-2 text-sm font-medium ${"projects"===R?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"}`,onClick:()=>F("projects"),children:"Prosjekter"}),(0,s.jsx)("button",{className:`flex-1 px-4 py-2 text-sm font-medium ${"abonnements"===R?"text-white border-b-2 border-blue-500":"text-gray-400 hover:text-white"}`,onClick:()=>F("abonnements"),children:"Vedlikeholdsavtaler"})]}),"projects"===R&&(0,s.jsxs)("div",{className:"p-4 flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:"Prosjekter"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("button",{onClick:()=>D(!k),className:"flex items-center text-sm text-gray-400 hover:text-white",children:[(0,s.jsx)(n,{className:"w-4 h-4 mr-1"}),"Filter: ","all"===w?"Alle":"active"===w?"Aktive":"completed"===w?"Fullf\xf8rte":"Arkiverte"]}),(0,s.jsx)("div",{ref:P,className:`absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg z-10 ${k?"block":"hidden"}`,children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{N("all"),D(!1)},children:"Alle"}),(0,s.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{N("active"),D(!1)},children:"Aktive"}),(0,s.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{N("completed"),D(!1)},children:"Fullf\xf8rte"}),(0,s.jsx)("button",{className:"block w-full text-left px-4 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white",onClick:()=>{N("archived"),D(!1)},children:"Arkiverte"})]})})]})]}),(0,s.jsx)("div",{className:"space-y-2 overflow-y-auto flex-1",children:J.map(e=>(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-3 cursor-move hover:bg-gray-750 border border-gray-700",draggable:!0,onDragStart:()=>V(e),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-white",children:e.name}),(0,s.jsx)("span",{className:`px-1.5 py-0.5 rounded-full text-xs font-medium ${"high"===e.priority?"bg-red-900/50 text-red-400":"medium"===e.priority?"bg-yellow-900/50 text-yellow-400":"bg-green-900/50 text-green-400"}`,children:e.priority})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1 truncate",children:e.client})]},e.id))})]}),"abonnements"===R&&(0,s.jsxs)("div",{className:"p-4 flex-1 flex flex-col",children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:"Vedlikeholdsavtaler"})}),(0,s.jsx)("div",{className:"space-y-2 overflow-y-auto flex-1",children:t.map(e=>(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-3 cursor-move hover:bg-gray-750 border border-gray-700",draggable:!0,onDragStart:()=>{I(e),$(null)},children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-white",children:e.etternavn}),(0,s.jsx)("span",{className:"px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-900/50 text-blue-400",children:"Vedlikehold"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1 truncate",children:e.adresse}),(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.kommune})]},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:(()=>{if("month"===x)return u.toLocaleDateString("nb-NO",{month:"long",year:"numeric"});if("week"!==x)return u.toLocaleDateString("nb-NO",{weekday:"long",day:"numeric",month:"long",year:"numeric"});{let e=new Date(u),t=e.getDay();e.setDate(e.getDate()+(0===t?-6:1-t));let r=new Date(e);r.setDate(r.getDate()+6);let s=e.getMonth()===r.getMonth()?"":e.toLocaleDateString("nb-NO",{month:"long"})+" ";return`${s}${e.getDate()}. - ${r.toLocaleDateString("nb-NO",{day:"numeric",month:"long",year:"numeric"})}`}})()}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{if("month"===x)g(new Date(u.getFullYear(),u.getMonth()-1,1));else if("week"===x){let e=new Date(u);e.setDate(e.getDate()-7),g(e)}else if("day"===x){let e=new Date(u);e.setDate(e.getDate()-1),g(e)}},className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-gray-800",children:(0,s.jsx)(o,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{g(new Date)},className:"px-3 py-1.5 text-sm text-gray-400 hover:text-white",children:"I dag"}),(0,s.jsx)("button",{onClick:()=>{if("month"===x)g(new Date(u.getFullYear(),u.getMonth()+1,1));else if("week"===x){let e=new Date(u);e.setDate(e.getDate()+7),g(e)}else if("day"===x){let e=new Date(u);e.setDate(e.getDate()+1),g(e)}},className:"p-1.5 rounded-full text-gray-400 hover:text-white hover:bg-gray-800",children:(0,s.jsx)(i,{className:"w-5 h-5"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 p-2",children:["month"===x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-1",children:[0,1,2,3,4,5,6].map(e=>(0,s.jsx)("div",{className:"text-center text-xs font-medium text-gray-400 py-1",children:U(e)},e))}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 flex-1",children:f.map((e,t)=>(0,s.jsxs)("div",{className:`min-h-[100px] rounded-lg border ${e.isCurrentMonth?e.isToday?"bg-blue-900/20 border-blue-800":"bg-gray-800 border-gray-700":"bg-gray-850 border-gray-800"} p-1 relative`,onDragOver:t=>q(t,e.date),onDragEnter:z,onDragLeave:K,onDrop:t=>W(t,e.date),children:[(0,s.jsx)("div",{className:"flex justify-between items-center mb-1",children:(0,s.jsx)("span",{className:`text-xs font-medium ${e.isCurrentMonth?e.isToday?"text-blue-400":"text-white":"text-gray-500"}`,children:e.dayOfMonth})}),(0,s.jsxs)("div",{className:"space-y-1 overflow-y-auto max-h-[80px] min-h-[60px]",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("bg-gray-700/50")},onDragLeave:e=>{e.currentTarget.classList.remove("bg-gray-700/50")},onDrop:t=>{t.preventDefault(),t.currentTarget.classList.remove("bg-gray-700/50"),W(t,e.date)},children:[e.projects.map(t=>(0,s.jsxs)("div",{className:`text-xs p-1 rounded relative cursor-move transition-all duration-200 hover:shadow-lg ${"high"===t.priority?"bg-red-900/30 text-red-400 border border-red-800/50 hover:bg-red-900/40":"medium"===t.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50 hover:bg-yellow-900/40":"bg-green-900/30 text-green-400 border border-green-800/50 hover:bg-green-900/40"}`,onMouseEnter:()=>_(`${t.id}-${e.date.toISOString()}`),onMouseLeave:()=>_(null),children:[(0,s.jsx)("div",{className:"truncate",children:t.name}),O===`${t.id}-${e.date.toISOString()}`&&(0,s.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-48 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-2 text-xs",children:[(0,s.jsx)("h5",{className:"font-medium text-white mb-1",children:t.name}),(0,s.jsx)("p",{className:"text-gray-400 mb-1",children:t.client}),(0,s.jsx)("p",{className:"text-gray-400 mb-1 line-clamp-2",children:t.description}),(0,s.jsx)("button",{onClick:()=>B(t.id,e.date.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs mt-1",children:"Fjern fra kalender"})]})]},`project-${t.id}-${e.date.toISOString()}`)),e.abonnements.map(t=>(0,s.jsxs)("div",{className:"text-xs p-1 rounded relative cursor-move transition-all duration-200 hover:shadow-lg bg-blue-900/30 text-blue-400 border border-blue-800/50 hover:bg-blue-900/40",onMouseEnter:()=>L(`${t.id}-${e.date.toISOString()}`),onMouseLeave:()=>L(null),children:[(0,s.jsx)("div",{className:"truncate",children:t.etternavn}),C===`${t.id}-${e.date.toISOString()}`&&(0,s.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-48 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-2 text-xs",children:[(0,s.jsx)("h5",{className:"font-medium text-white mb-1",children:t.etternavn}),(0,s.jsx)("p",{className:"text-gray-400 mb-1",children:t.adresse}),(0,s.jsx)("p",{className:"text-gray-400 mb-1",children:t.kommune}),(0,s.jsx)("button",{onClick:()=>Z(t.id,e.date.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs mt-1",children:"Fjern fra kalender"})]})]},`abonnement-${t.id}-${e.date.toISOString()}`)),e.inspections.map(t=>(0,s.jsxs)("div",{className:"text-xs p-1 rounded relative bg-yellow-900/30 text-yellow-300 border border-yellow-800/50 mt-1 flex items-center gap-1",title:t.inspection_type,children:[(0,s.jsx)("span",{className:"font-bold",children:"Inspeksjon:"})," ",t.customer_name,(0,s.jsx)("span",{className:"ml-auto px-1 py-0.5 rounded bg-yellow-800/50 text-yellow-200 text-[10px]",children:t.inspection_type})]},`inspection-${t.id}-${e.date.toISOString()}`))]})]},t))})]}),"week"===x&&(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-1",children:Array.from({length:7}).map((e,t)=>{let r=new Date(u),a=r.getDay(),l=t-(0===a?6:a-1);return r.setDate(r.getDate()+l),(0,s.jsxs)("div",{className:"text-center py-2",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-400",children:U(t)}),(0,s.jsx)("div",{className:`text-sm font-medium ${r.toDateString()===new Date().toDateString()?"text-blue-400":"text-white"}`,children:r.getDate()})]},t)})}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 flex-1",children:Array.from({length:7}).map((e,t)=>{let r=new Date(u),a=r.getDay(),l=t-(0===a?6:a-1);r.setDate(r.getDate()+l);let n=r.toISOString().split("T")[0],o=p.filter(e=>e.scheduledDate===n),i=j.filter(e=>e.scheduledDate===n);return(0,s.jsx)("div",{className:`min-h-[400px] rounded-lg border ${r.toDateString()===new Date().toDateString()?"bg-blue-900/20 border-blue-800":"bg-gray-800 border-gray-700"} p-2 relative`,onDragOver:e=>q(e,r),onDragEnter:z,onDragLeave:K,onDrop:e=>W(e,r),children:(0,s.jsxs)("div",{className:"space-y-2 overflow-y-auto max-h-full",children:[o.map(e=>(0,s.jsxs)("div",{className:`p-2 rounded relative ${"high"===e.priority?"bg-red-900/30 text-red-400 border border-red-800/50":"medium"===e.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50":"bg-green-900/30 text-green-400 border border-green-800/50"}`,onMouseEnter:()=>_(`${e.id}-${r.toISOString()}`),onMouseLeave:()=>_(null),children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),(0,s.jsx)("div",{className:"text-xs mt-1",children:e.client}),O===`${e.id}-${r.toISOString()}`&&(0,s.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-64 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-3 text-sm",children:[(0,s.jsx)("h5",{className:"font-medium text-white mb-1",children:e.name}),(0,s.jsx)("p",{className:"text-gray-400 mb-1",children:e.client}),(0,s.jsx)("p",{className:"text-gray-400 mb-2",children:e.description}),(0,s.jsx)("button",{onClick:()=>B(e.id,n),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},`project-${e.id}-${r.toISOString()}`)),i.map(e=>(0,s.jsxs)("div",{className:"p-2 rounded relative bg-blue-900/30 text-blue-400 border border-blue-800/50",onMouseEnter:()=>L(`${e.id}-${r.toISOString()}`),onMouseLeave:()=>L(null),children:[(0,s.jsx)("div",{className:"font-medium",children:e.etternavn}),(0,s.jsx)("div",{className:"text-xs mt-1",children:e.adresse}),C===`${e.id}-${r.toISOString()}`&&(0,s.jsxs)("div",{className:"absolute z-10 left-0 top-full mt-1 w-64 bg-gray-900 rounded-lg shadow-lg border border-gray-700 p-3 text-sm",children:[(0,s.jsx)("h5",{className:"font-medium text-white mb-1",children:e.etternavn}),(0,s.jsx)("p",{className:"text-gray-400 mb-1",children:e.adresse}),(0,s.jsx)("p",{className:"text-gray-400 mb-2",children:e.kommune}),(0,s.jsx)("button",{onClick:()=>Z(e.id,n),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},`abonnement-${e.id}-${r.toISOString()}`))]})},t)})})]}),"day"===x&&(0,s.jsx)("div",{className:"flex flex-col h-full",children:(0,s.jsx)("div",{className:"flex-1 p-4 bg-gray-800 rounded-lg border border-gray-700 mt-2 overflow-y-auto",onDragOver:e=>q(e,u),onDragEnter:z,onDragLeave:K,onDrop:e=>W(e,u),children:(0,s.jsxs)("div",{className:"space-y-3",children:[p.filter(e=>e.scheduledDate===u.toISOString().split("T")[0]).map(e=>(0,s.jsxs)("div",{className:`p-4 rounded-lg relative ${"high"===e.priority?"bg-red-900/30 text-red-400 border border-red-800/50":"medium"===e.priority?"bg-yellow-900/30 text-yellow-400 border border-yellow-800/50":"bg-green-900/30 text-green-400 border border-green-800/50"}`,children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h4",{className:"font-medium text-white",children:e.name}),(0,s.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"active"===e.status?"bg-blue-900/50 text-blue-400":"completed"===e.status?"bg-green-900/50 text-green-400":"bg-gray-900/50 text-gray-400"}`,children:e.status})]}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.description}),(0,s.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:["Klient: ",(0,s.jsx)("span",{className:"text-white",children:e.client})]}),(0,s.jsx)("button",{onClick:()=>B(e.id,u.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},`project-${e.id}`)),j.filter(e=>e.scheduledDate===u.toISOString().split("T")[0]).map(e=>(0,s.jsxs)("div",{className:"p-4 rounded-lg relative bg-blue-900/30 text-blue-400 border border-blue-800/50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h4",{className:"font-medium text-white",children:e.etternavn}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-900/50 text-blue-400",children:"Vedlikehold"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.adresse}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:e.kommune}),(0,s.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:["Fornyelse: ",(0,s.jsx)("span",{className:"text-white",children:e.fornyelsesdato})]}),(0,s.jsx)("button",{onClick:()=>Z(e.id,u.toISOString().split("T")[0]),className:"text-red-400 hover:text-red-300 text-xs",children:"Fjern fra kalender"})]})]},`abonnement-${e.id}`)),r.filter(e=>e.inspection_date===u.toISOString().split("T")[0]).map(e=>(0,s.jsxs)("div",{className:"p-4 rounded-lg relative bg-yellow-900/30 text-yellow-300 border border-yellow-800/50",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("h4",{className:"font-medium text-white",children:["Inspeksjon: ",e.customer_name]}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-800/50 text-yellow-200",children:e.inspection_type})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Adresse: ",e.customer_address]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Inspekt\xf8r: ",e.inspector||"-"]}),(0,s.jsx)("div",{className:"mt-3 flex justify-between items-center",children:(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:["Status: ",(0,s.jsx)("span",{className:"text-white",children:e.status})]})})]},`inspection-${e.id}`)),0===p.filter(e=>e.scheduledDate===u.toISOString().split("T")[0]).length&&0===j.filter(e=>e.scheduledDate===u.toISOString().split("T")[0]).length&&0===r.filter(e=>e.inspection_date===u.toISOString().split("T")[0]).length&&(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)("p",{children:"Ingen aktiviteter planlagt for denne dagen"}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"Dra et prosjekt eller en vedlikeholdsavtale hit for \xe5 planlegge det"})]})]})})})]})]})]})]})})}},98980:(e,t,r)=>{r.d(t,{NA:()=>o,OR:()=>i,R2:()=>a,lt:()=>n,s2:()=>l});var s=r(16391);async function a(){let{data:e,error:t}=await s.ND.from("abonnementer").select("*").order("etternavn",{ascending:!0});if(t)throw console.error("Error fetching abonnements:",t),t;return e||[]}async function l(){let{data:e,error:t}=await s.ND.from("scheduled_abonnements").select(`
      *,
      abonnementer:abonnement_id (*)
    `).order("scheduled_date",{ascending:!0});if(t)throw console.error("Error fetching scheduled abonnements:",t),t;return e||[]}async function n(e,t){try{let r=Number(e);if(isNaN(r))throw Error(`Invalid abonnement ID: ${e}`);if(!t||!Date.parse(t))throw Error(`Invalid date format: ${t}`);let{data:a,error:l}=await s.ND.from("scheduled_abonnements").insert([{abonnement_id:r,scheduled_date:t}]).select();if(l)throw console.error(`Error scheduling abonnement ${e} for date ${t}:`,{message:l.message,code:l.code,details:l.details,hint:l.hint}),Error(`Failed to schedule: ${l.message}`);if(!a||0===a.length)throw Error("No data returned from scheduling operation");return a[0]}catch(t){throw console.error(`Failed to schedule abonnement ${e}:`,{error:t instanceof Error?t.message:t,stack:t instanceof Error?t.stack:void 0}),Error(`Failed to schedule abonnement: ${t instanceof Error?t.message:"Unknown error"}`)}}async function o(e,t){let{error:r}=await s.ND.from("scheduled_abonnements").delete().eq("abonnement_id",e).eq("scheduled_date",t);if(r)throw console.error(`Error unscheduling abonnement ${e} for date ${t}:`,r),r;return!0}async function i(e){let t=[];for(let r of e)try{let e=await d(r);t.push(e)}catch(e){throw console.error(`Failed to create abonnement for ${r.fornavn} ${r.etternavn}:`,e),e}return t}async function d(e){let{data:t,error:r}=await s.ND.from("abonnementer").insert([{fornavn:e.fornavn,etternavn:e.etternavn,adresse:e.adresse,kommune:e.kommune,var:e.var,host:e.host,epost:e.epost,fakturert:e.fakturert,fornyelsesdato:e.fornyelsesdato,sum:e.sum,notat:e.notat}]).select();if(r)throw console.error("Error creating abonnement:",r),r;return t?.[0]}}};